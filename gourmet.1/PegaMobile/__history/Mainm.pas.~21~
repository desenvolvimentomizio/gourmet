unit Mainm;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, db,
  Controls, Forms, Dialogs, uniGUITypes, uniGUIAbstractClasses,
  uniGUIClasses, uniGUIRegClasses, uniGUIForm, uniGUImForm, uniGUImJSForm,
  uniPanel, uniPageControl, unimTabPanel, uniGUIBaseClasses, uniEdit, unimEdit,
  uniLabel, unimLabel, unimPanel, uniImage, unimImage, uniButton, uniBitBtn,
  unimBitBtn, Vcl.Imaging.jpeg, unimScrollBox, unimCarousel, uniHTMLFrame,
  unimHTMLFrame, uniMultiItem, unimList, unimDBList, uniDBNavigator,
  unimDBNavigator, uniDBEdit, unimDBEdit, uniBasicGrid, uniDBGrid,
  unimDBListGrid, Vcl.Imaging.pngimage, uniMemo, unimMemo, Uni, uniDBImage, unimDBImage, uniImageList,
  unimButton, unimDBGrid;

type
  TUsuario = record
    clbcodigo: integer;
    clbidentificacao: string;
    cznchave: integer;
    QtdMesa: integer;
    tsicodigo: integer;
    QtdColulas: integer;
    TituloOperador: string;
  end;

  TMainmForm = class(TUnimForm)
    TabPanel: TUnimTabPanel;
    TabLogin: TUnimTabSheet;
    TabMesa: TUnimTabSheet;
    TabPedido: TUnimTabSheet;
    UnimImage1: TUnimImage;
    BtnLoginConfirmar: TUnimBitBtn;
    UnimPanel3: TUnimPanel;
    vScrollBox: TUnimScrollBox;
    PnMesa8: TUnimPanel;
    PnMesa9: TUnimPanel;
    PnMesa10: TUnimPanel;
    PnMesa11: TUnimPanel;
    PnMesa12: TUnimPanel;
    PnMesa13: TUnimPanel;
    PnMesa16: TUnimPanel;
    PnMesa15: TUnimPanel;
    PnMesa7: TUnimPanel;
    PnMesa6: TUnimPanel;
    PnMesa5: TUnimPanel;
    PnMesa4: TUnimPanel;
    PnMesa3: TUnimPanel;
    PnMesa2: TUnimPanel;
    PnMesa1: TUnimPanel;
    PnMesa17: TUnimPanel;
    PnMesa18: TUnimPanel;
    PnMesa19: TUnimPanel;
    PnMesa20: TUnimPanel;
    PnMesa14: TUnimPanel;
    PnMensagemCozinha: TUnimPanel;
    LbLoginMensagem: TUnimLabel;
    BtnVerificaCozinha: TUnimBitBtn;
    EdtUsuario: TUnimEdit;
    EdtSenha: TUnimEdit;
    TabCardGrp: TUnimTabSheet;
    TabCardOpcao: TUnimTabSheet;
    PnCardapio: TUnimPanel;
    plTopoPedido: TUnimPanel;
    BtTabPedRetonoMesa: TUnimBitBtn;
    UnimPanel1: TUnimPanel;
    UnimPanel2: TUnimPanel;
    LbMesaCard: TUnimLabel;
    UnimPanel14: TUnimPanel;
    UnimPanel15: TUnimPanel;
    BtTabCardRetono: TUnimBitBtn;
    BtTabPedRetonoLogin: TUnimBitBtn;
    UnimPanel16: TUnimPanel;
    UnimPanel19: TUnimPanel;
    BtTabMesaRetorno: TUnimBitBtn;
    UnimPanel18: TUnimPanel;
    btnTabPedConfirma: TUnimBitBtn;
    BtnTabPedPedido: TUnimBitBtn;
    BtnPedPessoa: TUnimBitBtn;
    LbVersao: TUnimLabel;
    BtnMostraItem: TUnimBitBtn;
    PnTotal: TUnimPanel;
    UnimPanel21: TUnimPanel;
    LbtitTotal: TUnimLabel;
    LbTotal: TUnimLabel;
    UnimPanel17: TUnimPanel;
    UnimPanel23: TUnimPanel;
    UnimLabel3: TUnimLabel;
    UnimLabel4: TUnimLabel;
    UnimPanel24: TUnimPanel;
    LbRecebido: TUnimLabel;
    LbFalta: TUnimLabel;
    GridTabCardTipoGrupo: TUnimDBGrid;
    GridTabCardClasseGrupo: TUnimDBListGrid;
    plLocal: TUnimPanel;
    EdtLocal: TUnimNumberEdit;
    UnimBitBtn1: TUnimBitBtn;
    UnimPanel8: TUnimPanel;
    TextoProduto: TUnimEdit;
    NumeProduto: TUnimNumberEdit;
    LbMesa: TUnimLabel;
    BtTabPedIncluirItem: TUnimBitBtn;
    BtTabPedExcluirItem: TUnimBitBtn;
    UnimPanel25: TUnimPanel;
    BtTabOpcaoIncluirItem: TUnimBitBtn;
    LbCardapio: TUnimLabel;
    UnimPanel27: TUnimPanel;
    BtTabOpcaoRetorno: TUnimBitBtn;
    edBuscaItem: TUnimEdit;
    btBuscaItem: TUnimBitBtn;
    UnimLabel2: TUnimLabel;
    UnimDBGridPedidos: TUnimDBGrid;
    PnModoPessoas: TUnimPanel;
    lbdividir: TUnimLabel;
    PnPessoas: TUnimPanel;
    UnimPanel12: TUnimPanel;
    EdtPedQtde: TUnimNumberEdit;
    UnimBitBtn3: TUnimBitBtn;
    BtnTabPedQtdeMais: TUnimBitBtn;
    LbTotalTaxa: TUnimLabel;
    PnMesa21: TUnimPanel;
    PnMesa22: TUnimPanel;
    PnMesa23: TUnimPanel;
    PnMesa24: TUnimPanel;
    PnMesa25: TUnimPanel;
    btTransferirmesa: TUnimButton;
    PnMesa26: TUnimPanel;
    PnMesa27: TUnimPanel;
    PnMesa28: TUnimPanel;
    PnMesa29: TUnimPanel;
    PnMesa30: TUnimPanel;
    PnMesa31: TUnimPanel;
    PnMesa32: TUnimPanel;
    UnimPanel4: TUnimPanel;
    UnimBitBtnObs: TUnimBitBtn;
    UnimDBListGrid1: TUnimDBListGrid;
    GridTabCardGrupo: TUnimDBListGrid;
    PnMesa33: TUnimPanel;
    PnMesa34: TUnimPanel;
    PnMesa35: TUnimPanel;
    PnMesa36: TUnimPanel;
    PnMesa37: TUnimPanel;
    PnMesa38: TUnimPanel;
    PnMesa39: TUnimPanel;
    PnMesa40: TUnimPanel;
    PnMesa41: TUnimPanel;
    PnMesa42: TUnimPanel;
    PnMesa43: TUnimPanel;
    PnMesa44: TUnimPanel;
    PnMesa45: TUnimPanel;
    PnMesa46: TUnimPanel;
    PnMesa47: TUnimPanel;
    PnMesa49: TUnimPanel;
    PnMesa50: TUnimPanel;
    PnMesa51: TUnimPanel;
    PnMesa52: TUnimPanel;
    PnMesa53: TUnimPanel;
    PnMesa54: TUnimPanel;
    PnMesa55: TUnimPanel;
    PnMesa56: TUnimPanel;
    PnMesa57: TUnimPanel;
    PnMesa58: TUnimPanel;
    PnMesa59: TUnimPanel;
    PnMesa60: TUnimPanel;
    PnMesa61: TUnimPanel;
    PnMesa62: TUnimPanel;
    PnMesa63: TUnimPanel;
    PnMesa64: TUnimPanel;
    PnMesa65: TUnimPanel;
    PnMesa66: TUnimPanel;
    PnMesa67: TUnimPanel;
    PnMesa68: TUnimPanel;
    PnMesa69: TUnimPanel;
    PnMesa70: TUnimPanel;
    PnMesa48: TUnimPanel;

    procedure VerificaCozinha;
    Procedure CarregaMesa;
    procedure AbreCardapio;
    procedure MostraTab(Tab: TUnimTabSheet);
    procedure EnviaItens;
    procedure ConfirmaItens;
    procedure Comanda;
    procedure SolicitaFechamento;
    procedure IncluirItemFracionado;
    procedure ApresentaItem(pOrcChave, pItoChave: integer);
    procedure ApresentaPreItem;

    procedure BtnLoginConfirmarClick(Sender: TObject);
    procedure UnimFormShow(Sender: TObject);
    procedure GeraMessa(Panel: TUnimPanel; QtdPanel, Posi: integer);
    procedure EventoBtnClick(Sender: TObject);
    procedure BtnVerificaCozinhaClick(Sender: TObject);
    procedure BtTabPedExcluirItemClick(Sender: TObject);
    procedure GridTabCardGrupo1Click(Sender: TObject);
    procedure BtTabOpcaoIncluirItemClick(Sender: TObject);
    procedure BtTabOpcaoRetornoClick(Sender: TObject);
    procedure BtTabPedIncluirItemClick(Sender: TObject);
    procedure BtTabPedRetonoMesaClick(Sender: TObject);
    procedure BtTabCardRetonoClick(Sender: TObject);
    procedure BtTabPedRetonoLoginClick(Sender: TObject);
    procedure BtnTabPedQtdeMenosClick(Sender: TObject);
    procedure BtnTabPedQtdeMaisClick(Sender: TObject);
    procedure BtnTabPedPedidoClick(Sender: TObject);
    procedure btnTabPedConfirmaClick(Sender: TObject);
    procedure BtnPedPessoaClick(Sender: TObject);
    procedure BtTabMesaRetornoClick(Sender: TObject);
    procedure BtnMostraItemClick(Sender: TObject);
    procedure TextoProdutoEnter(Sender: TObject);
    procedure btBuscaItemClick(Sender: TObject);
    procedure TabPanelChange(Sender: TObject);
    procedure GridTabCardTipoGrupoClick(Sender: TObject);
    procedure GridTabCardClasseGrupoClick(Sender: TObject);
    procedure UnimBitBtn1Click(Sender: TObject);
    procedure UnimDBListGrid1DblClick(Sender: TObject);
    procedure UnimFormScreenResize(Sender: TObject; AWidth, AHeight: integer);
    procedure UnimDBGridPedidosDblClick(Sender: TObject);
    procedure btTransferirmesaClick(Sender: TObject);
    procedure UnimBitBtnObsClick(Sender: TObject);
    procedure GridTabCardGrupoDrawColumnCell(Sender: TObject; ACol, ARow: integer; Column: TunimDBGridColumn; Attribs: TUniCellAttribs);
    procedure UnimDBGridPedidosClick(Sender: TObject);

  private
    { Private declarations }
    vpUsuario: boolean;
    procedure DCallBackExcluirItem(Sender: TComponent; Res: integer);
    procedure DCallBackAbandonaMesa(Sender: TComponent; Res: integer);
    procedure DCallBackEncerraMesa(Sender: TComponent; Res: integer);
    procedure VerificaMesa;
    function AlteraFonte(Tamanho: integer; estilo, cor: String): String;
    procedure LimpaTotal;
    procedure MostraItensGrupo;
    procedure MostraCardapio;
    procedure AjustaPaineldeMesas(vSituacao: boolean);
    procedure AjustaBotoesPainel(vPnMesa: TUnimPanel);

  public
    { Public declarations }
    Usuario: TUsuario;
    vpMesaGer: integer;
    vpNumeroMesa: String;
    vpLargura: integer;
    vpAltura: integer;
    vpId: integer;
    // vScrollBox: TUnimScrollBox;
    procedure ShowCallBack(Sender: TComponent; AResult: integer);
  end;

function MainmForm: TMainmForm;

implementation

{$R *.dfm}

uses
  uniGUIVars, uniGUIApplication, ufIncluir, ufIncluirFracionado,
  ufItem, ufnumeromesas, MainModule, ufTransfereMesa, ufobs, System.Math;

function MainmForm: TMainmForm;
begin
  Result := TMainmForm(MainModule.UniMainModule.GetFormInstance(TMainmForm));
end;

procedure TMainmForm.ShowCallBack(Sender: TComponent; AResult: integer);
begin

  MainmForm.vpNumeroMesa := fnumeromesas.edNumeroMesa.Text;
  MainModule.UniMainModule.SQL('update orc set orcmesa=' + vpNumeroMesa + ' , orcpessoas = ''' + FormatFloat('###000', EdtPedQtde.Value) +
    ''' where orcchave = ' + MainModule.UniMainModule.orcorcchave.AsString);

end;

procedure TMainmForm.AjustaPaineldeMesas(vSituacao: boolean);
begin
  PnMesa1.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa1);
  PnMesa2.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa2);
  PnMesa3.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa3);
  PnMesa4.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa4);
  PnMesa5.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa5);
  PnMesa6.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa6);
  PnMesa7.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa7);
  PnMesa8.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa8);
  PnMesa9.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa9);
  PnMesa10.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa10);

  PnMesa11.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa11);

  PnMesa12.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa12);

  PnMesa13.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa13);

  PnMesa14.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa14);

  PnMesa15.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa15);

  PnMesa16.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa16);

  PnMesa17.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa17);

  PnMesa18.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa18);

  PnMesa19.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa19);

  PnMesa20.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa20);

  PnMesa21.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa21);

  PnMesa22.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa22);

  PnMesa23.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa23);

  PnMesa24.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa24);

  PnMesa25.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa25);

  PnMesa26.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa26);

  PnMesa27.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa27);

  PnMesa28.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa28);

  PnMesa29.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa29);

  PnMesa30.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa30);

  PnMesa31.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa31);

  PnMesa32.Enabled := vSituacao;
  AjustaBotoesPainel(PnMesa32);

end;

procedure TMainmForm.AjustaBotoesPainel(vPnMesa: TUnimPanel);
var
  i: integer;
begin
  for i := 0 to vPnMesa.ControlCount - 1 do
  begin
    if (vPnMesa.Controls[i] is TUnimBitBtn) then
    begin
      (vPnMesa.Controls[i] as TUnimBitBtn).Enabled := vPnMesa.Enabled;
      (vPnMesa.Controls[i] as TUnimBitBtn).Repaint;
    end;
  end;

end;

procedure TMainmForm.MostraCardapio;
begin
  with MainModule.UniMainModule do
  begin
    if not UniMainModule.cgr.IsEmpty then
    begin
      UniMainModule.tgr.Close;
      UniMainModule.tgr.ParamByName('cgrcodigo').AsInteger := UniMainModule.cgrcgrcodigo.AsInteger;
      UniMainModule.tgr.Open;

      UniMainModule.grp.Close;
      UniMainModule.grp.ParamByName('tgrcodigo').AsInteger := UniMainModule.tgrtgrcodigo.AsInteger;
      UniMainModule.grp.ParamByName('cgrcodigo').AsInteger := -1;
      UniMainModule.grp.Open;

      GridTabCardGrupo.Visible := true;
      GridTabCardTipoGrupo.Visible := false;
      GridTabCardClasseGrupo.Visible := false;

      if (UniMainModule.cgr.RecordCount >= 1) { and (UniMainModule.grp.RecordCount = 1) } then
      begin

        UniMainModule.grp.Close;
        UniMainModule.grp.ParamByName('tgrcodigo').AsInteger := UniMainModule.tgrtgrcodigo.AsInteger;
        UniMainModule.grp.ParamByName('cgrcodigo').AsInteger := UniMainModule.cgrcgrcodigo.AsInteger;
        UniMainModule.grp.Open;

        GridTabCardGrupo.Visible := true;
        GridTabCardTipoGrupo.Visible := false;
        GridTabCardClasseGrupo.Visible := false;

        MostraTab(TabCardGrp);

        // GridTabCardGrupo1Click(GridTabCardTipoGrupo);
      end
      else
      begin

      end;

    end;
  end;
end;

procedure TMainmForm.MostraItensGrupo;
begin
  with MainModule.UniMainModule do
  begin
    if not UniMainModule.tgr.IsEmpty then
    begin

      UniMainModule.grp.Close;
      UniMainModule.grp.ParamByName('tgrcodigo').AsInteger := UniMainModule.tgrtgrcodigo.AsInteger;
      UniMainModule.grp.ParamByName('grpcodigo').AsInteger := -1;
      UniMainModule.grp.Open;

      if UniMainModule.grp.RecordCount = 1 then
      begin
        GridTabCardGrupo1Click(GridTabCardTipoGrupo);
      end;

    end;
  end;
end;

procedure TMainmForm.AbreCardapio;
begin
  // mudando a TAB do btnPedConfirma para 1 que trata do envio dos pedidos
  if btnTabPedConfirma.Tag <> 0 then
  begin

    PnModoPessoas.Visible := false;
    btnTabPedConfirma.Caption := 'Confirma';
    if btnTabPedConfirma.Tag <> 2 then
      btnTabPedConfirma.Tag := 0;

    with MainModule.UniMainModule do
    begin
      UniMainModule.vtItens.DisableControls;
      if not UniMainModule.vtItens.IsEmpty then
      begin
        UniMainModule.vtItens.First;
        while not UniMainModule.vtItens.Eof do
        begin
          if UniMainModule.vtItensStatus.Value = 1 then
            UniMainModule.vtItens.Delete
          else
            UniMainModule.vtItens.Next;
        end;
      end;
      UniMainModule.vtItens.EnableControls;
    end;
  end;

  with MainModule.UniMainModule do
  begin
    { UniMainModule.cgr.Close;
      UniMainModule.cgr.Open;

      UniMainModule.tgr.Close;
      UniMainModule.tgr.Open;

      UniMainModule.grp.Close;
      UniMainModule.grp.Open; }

    if not UniMainModule.cgr.active then
      UniMainModule.cgr.Open;

    if not UniMainModule.cgr.IsEmpty then
    begin

      if UniMainModule.cgr.RecordCount >= 1 then
      begin
        UniMainModule.tgr.Close;
        UniMainModule.tgr.ParamByName('cgrcodigo').AsInteger := UniMainModule.cgrcgrcodigo.AsInteger;
        UniMainModule.tgr.Open;

        UniMainModule.grp.Close;
        UniMainModule.grp.ParamByName('tgrcodigo').AsInteger := UniMainModule.tgrtgrcodigo.AsInteger;
        UniMainModule.grp.ParamByName('cgrcodigo').AsInteger := UniMainModule.cgrcgrcodigo.AsInteger;

        UniMainModule.grp.Open;

        if GridTabCardClasseGrupo.Visible = true then
        begin
          if UniMainModule.cgr.RecordCount = 1 then
          begin
            GridTabCardGrupo.Visible := true;
            GridTabCardTipoGrupo.Visible := false;
            GridTabCardClasseGrupo.Visible := false;
            GridTabCardClasseGrupo.Width := 600;
          end
          else
          begin
            GridTabCardGrupo.Visible := false;
            GridTabCardTipoGrupo.Visible := false;
            GridTabCardClasseGrupo.Visible := true;
            GridTabCardClasseGrupo.Width := 600;
          end;
        end
        else
        begin
          GridTabCardGrupo.Visible := true;
          GridTabCardTipoGrupo.Visible := false;
          GridTabCardClasseGrupo.Visible := false;
          GridTabCardClasseGrupo.Width := 600;
        end;
      end
      else
      begin
        GridTabCardGrupo.Visible := false;
        GridTabCardTipoGrupo.Visible := false;
        GridTabCardClasseGrupo.Visible := true;
        GridTabCardClasseGrupo.Width := 600;
      end;

    end
    else
    begin
      UniMainModule.tgr.Close;
      UniMainModule.tgr.ParamByName('cgrcodigo').AsInteger := UniMainModule.cgrcgrcodigo.AsInteger;
      UniMainModule.tgr.Open;
      UniMainModule.grp.Close;
      UniMainModule.grp.ParamByName('tgrcodigo').AsInteger := UniMainModule.tgrtgrcodigo.AsInteger;
      UniMainModule.grp.Open;

      GridTabCardGrupo.Visible := true;
      GridTabCardTipoGrupo.Visible := false;
      GridTabCardClasseGrupo.Visible := false;
      GridTabCardClasseGrupo.Width := 600;

    end;

  end;
  if vpAltura > 800 then
  begin
    GridTabCardGrupo.Font.Size := 22;
    GridTabCardTipoGrupo.Font.Size := 22;
    GridTabCardClasseGrupo.Font.Size := 22;
    // UnimDBGridPedidos.Columns[1].Width := 260;
    UnimDBGridPedidos.Font.Size := 22;

    // UnimDBGrid1.Width := vpLargura;
    UnimDBGridPedidos.Width := vpLargura;
    // UnimDBGrid1.Columns[1].Width := 260;
    // UnimDBGrid1.Font.Size := 22;

  end
  else
  begin
    GridTabCardGrupo.Font.Size := 14;
    GridTabCardTipoGrupo.Font.Size := 14;
    GridTabCardClasseGrupo.Font.Size := 14;
    // UnimDBGrid1.Columns[1].Width := 180;
    // UnimDBGridPedidos.Columns[1].Width := 160;
    // UnimDBGridPedidos.Columns[1].Width := 160;
    // UnimDBGrid1.Font.Size := 14;
    // UnimDBGrid1.Width := vpLargura;
    UnimDBGridPedidos.Width := vpLargura;
  end;

end;

function TMainmForm.AlteraFonte(Tamanho: integer; estilo, cor: String): String;
var
  Retorno: String;
begin
  if estilo = 'b' then
    Retorno := '<font size=' + IntToStr(Tamanho) + ' color="' + cor + '" style=''''font-weight:bold;''''>'
  else
    Retorno := '<font size=' + IntToStr(Tamanho) + ' color="' + cor + '" >';
  Result := Retorno;
end;

procedure TMainmForm.ApresentaItem(pOrcChave, pItoChave: integer);
var
  vSQL: String;
  vFonte: String;
begin
  vSQL := 'SELECT COUNT(*) fsncount ' + '  FROM sfn ' + ' INNER JOIN pro ON sfn.procodigo = pro.procodigo ' +
    ' INNER JOIN ito on pro.procodigo = ito.procodigo  ' + ' WHERE ito.itochave = ' + IntToStr(pItoChave);
  MainModule.UniMainModule.ConsultaSQL(vSQL);

  fItem.MemPro.HTML.Clear;

  MainModule.UniMainModule.Item.Close;
  MainModule.UniMainModule.Item.Params[0].AsInteger := pOrcChave; // orcchave
  MainModule.UniMainModule.Item.Params[1].AsInteger := pItoChave; // itochave
  MainModule.UniMainModule.Item.Open;
  if not MainModule.UniMainModule.Item.IsEmpty then
  begin
    // Escrevendo nome do produto
    vFonte := AlteraFonte(12, 'b', 'black');
    fItem.MemPro.HTML.Add(vFonte + MainModule.UniMainModule.Itempronome.AsString + '</font></br>');

    // caso produto seja fracionado
    if MainModule.UniMainModule.Consulta.Fields[0].AsInteger > 0 then
    begin
      // Escrevendo bordas do produto quando existir
      MainModule.UniMainModule.itemBorda.Close;
      MainModule.UniMainModule.itemBorda.Params[0].AsInteger := pOrcChave; // orcchave
      MainModule.UniMainModule.itemBorda.Params[1].AsInteger := pItoChave; // itochave
      MainModule.UniMainModule.itemBorda.Open;
      if not MainModule.UniMainModule.itemBorda.IsEmpty then
      begin
        fItem.MemPro.HTML.Add('');
        // AlteraFonte(fItem.MemPro, 16, fsBold, clBlue);
        vFonte := AlteraFonte(10, 'b', 'blue');
        fItem.MemPro.HTML.Add(vFonte + '*** BORDAS ***</font></br>');
        MainModule.UniMainModule.itemBorda.First;
        while not MainModule.UniMainModule.itemBorda.Eof do
        begin
          // AlteraFonte(fItem.MemPro, 12, fsBold, clBlack);
          vFonte := AlteraFonte(10, 'b', 'black');
          fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:30px">' + MainModule.UniMainModule.ItemBordabrdidentificacao.AsString +
            '</font></br>');
          MainModule.UniMainModule.itemBorda.Next;
        end;
      end;

      // Escrevendo sabores do produto quando existir
      MainModule.UniMainModule.itemSabor.Close;
      MainModule.UniMainModule.itemSabor.Params[0].AsInteger := pOrcChave; // orcchave
      MainModule.UniMainModule.itemSabor.Params[1].AsInteger := pItoChave; // itochave
      MainModule.UniMainModule.itemSabor.Open;

      if not MainModule.UniMainModule.itemSabor.IsEmpty then
      begin
        fItem.MemPro.HTML.Add('');
        // AlteraFonte(fItem.MemPro, 16, fsBold, clGreen);
        vFonte := AlteraFonte(12, 'b', 'Green');
        fItem.MemPro.HTML.Add(vFonte + '*** SABORES ***</font></br>');
        MainModule.UniMainModule.itemSabor.First;
        while not MainModule.UniMainModule.itemSabor.Eof do
        begin
          // AlteraFonte(fItem.MemPro, 14, fsBold, clBlack);
          vFonte := AlteraFonte(12, 'b', 'black');
          fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:30px">' + MainModule.UniMainModule.ItemSaborsbridentificacao.AsString +
            '</font></br>');
          // Escrevendo sabores do produto quando existir
          MainModule.UniMainModule.ItemIngredientefra.Close;
          MainModule.UniMainModule.ItemIngredientefra.Params[0].AsInteger := pOrcChave; // orcchave
          MainModule.UniMainModule.ItemIngredientefra.Params[1].AsInteger := pItoChave; // itochave
          MainModule.UniMainModule.ItemIngredientefra.Params[2].AsInteger := MainModule.UniMainModule.ItemSaborsbichave.AsInteger; // sbichave
          MainModule.UniMainModule.ItemIngredientefra.Open;
          if not MainModule.UniMainModule.ItemIngredientefra.IsEmpty then
          begin
            MainModule.UniMainModule.ItemIngredientefra.First;
            while not MainModule.UniMainModule.ItemIngredientefra.Eof do
            begin
              if MainModule.UniMainModule.ItemIngredienteFraisitipo.AsInteger = 0 then
              begin
                // AlteraFonte(fItem.MemPro, 11, fsBold, clBlack);
                // vFonte := AlteraFonte(8, 'b', 'black');
                fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:50px">' +
                  MainModule.UniMainModule.ItemIngredienteFratsiidentificacao.AsString + ' ' +
                  MainModule.UniMainModule.ItemIngredienteFraingnome.AsString + '</font></br>')
              end
              else
              begin
                // AlteraFonte(fItem.MemPro, 11, fsBold, clMaroon);
                // vFonte := AlteraFonte(8, 'b', 'Maroon');
                fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:50px">' + 'ADICIONAR ' +
                  MainModule.UniMainModule.ItemIngredienteFraingnome.AsString + ' (' +
                  MainModule.UniMainModule.ItemIngredienteFratsiidentificacao.AsString + ')</font></br>');
              end;
              MainModule.UniMainModule.ItemIngredientefra.Next;
            end;
          end;
          MainModule.UniMainModule.itemSabor.Next;
        end;
      end;
    end
    else
    // caso o item seja comum
    begin
      // Escrevendo sabores do produto quando existir
      MainModule.UniMainModule.ItemIngredienteNormal.Close;
      MainModule.UniMainModule.ItemIngredienteNormal.Params[0].AsInteger := pOrcChave; // orcchave
      MainModule.UniMainModule.ItemIngredienteNormal.Params[1].AsInteger := pItoChave; // itochave
      MainModule.UniMainModule.ItemIngredienteNormal.Open;
      if not MainModule.UniMainModule.ItemIngredienteNormal.IsEmpty then
      begin
        MainModule.UniMainModule.ItemIngredienteNormal.First;
        while not MainModule.UniMainModule.ItemIngredienteNormal.Eof do
        begin
          if MainModule.UniMainModule.ItemIngredienteNormalisitipo.AsInteger = 0 then
          begin
            // AlteraFonte(fItem.MemPro, 11, fsBold, clBlack);
            // vFonte := AlteraFonte(8, 'b', 'Black');
            fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:50px">' + MainModule.UniMainModule.ItemIngredienteNormaltsiidentificacao.
              AsString + ' ' + MainModule.UniMainModule.ItemIngredienteNormalingnome.AsString + '</font></br>')
          end
          else
          begin
            // AlteraFonte(fItem.MemPro, 11, fsBold, clMaroon);
            // vFonte := AlteraFonte(8, 'b', 'Maroon');
            fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:50px">' + 'ADICIONAR ' +
              MainModule.UniMainModule.ItemIngredienteNormalingnome.AsString + ' (' + MainModule.UniMainModule.ItemIngredienteNormaltsiidentificacao.
              AsString + ')</font></br>');
          end;
          MainModule.UniMainModule.ItemIngredienteNormal.Next;
        end;
      end;
    end;
  end;
  fItem.ShowFormModal(
    procedure
    begin
      // teste
    end);

end;

procedure TMainmForm.ApresentaPreItem;
var
  vSQL: String;
  vFonte: String;
  vlpronome: string;
  vltsiidentificacao: string;
  vlTemSabor: boolean;
begin
  fItem.MemPro.HTML.Clear;

  fItem.MemPro.HTML.Clear;
  fItem.MemPro.HTML.Add('<!DOCTYPE html>');
  fItem.MemPro.HTML.Add('<html>');
  fItem.MemPro.HTML.Add('<head>');
  fItem.MemPro.HTML.Add('<style>');
  fItem.MemPro.HTML.Add('header {');
  fItem.MemPro.HTML.Add('    background-color:red;');
  fItem.MemPro.HTML.Add('    color:white;');
  fItem.MemPro.HTML.Add('    text-align:center;');
  fItem.MemPro.HTML.Add('    padding:5px;');
  fItem.MemPro.HTML.Add('}');
  fItem.MemPro.HTML.Add('nav {');
  fItem.MemPro.HTML.Add('    line-height:30px;');
  fItem.MemPro.HTML.Add('    background-color:#ee00ee;');
  fItem.MemPro.HTML.Add('    height:auto;');
  fItem.MemPro.HTML.Add('    width:100px;');
  fItem.MemPro.HTML.Add('    float:left;');
  fItem.MemPro.HTML.Add('    padding:2px;');
  fItem.MemPro.HTML.Add('    overflow:auto;');
  fItem.MemPro.HTML.Add('}');
  fItem.MemPro.HTML.Add('section {');
  fItem.MemPro.HTML.Add('    width:350px;');
  fItem.MemPro.HTML.Add('    float:left;');
  fItem.MemPro.HTML.Add('    padding:10px;');
  fItem.MemPro.HTML.Add('}');
  fItem.MemPro.HTML.Add('footer {');
  fItem.MemPro.HTML.Add('    background-color:black;');
  fItem.MemPro.HTML.Add('    color:white;');
  fItem.MemPro.HTML.Add('    clear:both;');
  fItem.MemPro.HTML.Add('    text-align:center;');
  fItem.MemPro.HTML.Add('    padding:5px;');
  fItem.MemPro.HTML.Add('}</style>');
  fItem.MemPro.HTML.Add('</head>');

  if not MainModule.UniMainModule.vtItens.IsEmpty then
  begin
    // Escrevendo nome do produto
    // vFonte := AlteraFonte(12, 'b', 'black');
    // fItem.MemPro.HTML.Add(vFonte + MainModule.UniMainModule.vtItenspronome.AsString + '</font>');

    UniMainModule.vtItens.First;
    while not UniMainModule.vtItens.Eof do
    begin
      vFonte := AlteraFonte(10, 'b', 'black');
      fItem.MemPro.HTML.Add('</br>' + vFonte + UniMainModule.vtItensitoquantidade.AsString + ' x ' + UniMainModule.vtItenspronome.AsString + '</h1>');

      UniMainModule.tisi.First;
      vlTemSabor := false;
      while not UniMainModule.tisi.Eof do
      begin
        if UniMainModule.tisiisiitem.AsInteger = UniMainModule.vtItensitoitem.AsInteger then
        begin
          if (UniMainModule.tisiisitipo.AsInteger = 2) or (UniMainModule.tisiisitipo.AsInteger = 1) or
            (((UniMainModule.tisiisitipo.AsInteger = 0) and (UniMainModule.tisitsicodigo.AsInteger <> 3))) then
          begin

            if UniMainModule.tisiisitipo.AsInteger = 2 then
            begin
              vFonte := AlteraFonte(10, 'b', 'Green');
              fItem.MemPro.HTML.Add(vFonte + '</br>*** SABORES ***</font></br>');

              break;
            end;
          end;
        end;

        UniMainModule.tisi.Next;

      END;

      UniMainModule.tisi.First;
      while not UniMainModule.tisi.Eof do
      begin

        if UniMainModule.tisiisiitem.AsInteger = UniMainModule.vtItensitoitem.AsInteger then
        begin
          if (UniMainModule.tisiisitipo.AsInteger = 2) or (UniMainModule.tisiisitipo.AsInteger = 1) or
            (((UniMainModule.tisiisitipo.AsInteger = 0) and (UniMainModule.tisitsicodigo.AsInteger <> 3))) then
          begin

            if UniMainModule.tisiisitipo.AsInteger = 2 then
            begin
              UniMainModule.montapedido.Close;
              UniMainModule.montapedido.SQL.Text := 'select sbridentificacao from sbr where sbrcodigo=' + UniMainModule.tisisbrcodigo.AsString;
              UniMainModule.montapedido.Open;
              vlpronome := UniMainModule.montapedido.fieldbyname('sbridentificacao').AsString;

              vFonte := AlteraFonte(10, 'b', 'black');
              fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:30px">' + vlpronome + '</font></br>');

            end
            else
            begin

              UniMainModule.montapedido.Close;
              UniMainModule.montapedido.SQL.Text := 'select pronome from pro where procodigo=' + UniMainModule.tisiprocodigo.AsString;
              UniMainModule.montapedido.Open;
              vlpronome := UniMainModule.montapedido.fieldbyname('pronome').AsString;

              UniMainModule.montapedido.Close;
              UniMainModule.montapedido.SQL.Text := 'select tsiidentificacao from tsi where tsicodigo=' + UniMainModule.tisitsicodigo.AsString;
              UniMainModule.montapedido.Open;
              if UniMainModule.tisiisitipo.AsInteger = 1 then
                vltsiidentificacao := 'Adicionar ' + UniMainModule.tisiisiquantidade.AsString + ' x '
              else
                vltsiidentificacao := UniMainModule.montapedido.fieldbyname('tsiidentificacao').AsString;

              vFonte := AlteraFonte(8, 'b', 'black');
              fItem.MemPro.HTML.Add(vFonte + '<span style="padding-left:30px">' + vltsiidentificacao + ' ' + vlpronome + '</font></br>');

            end;

          end;

        end;

        UniMainModule.tisi.Next;
      end;

      UniMainModule.vtItens.Next;
    end;

  end;
  fItem.ShowFormModal(
    procedure
    begin
      // teste
    end);

end;

procedure TMainmForm.btBuscaItemClick(Sender: TObject);
begin
  if edBuscaItem.Text <> '' then
    (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := 'pronomereduzido like (' + QuotedStr('%' + edBuscaItem.Text + '%') + ')'
  else
    (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := '';

end;

procedure TMainmForm.BtnLoginConfirmarClick(Sender: TObject);
begin
  if MainModule.UniMainModule.Conexao.Connected then
  begin
    VerificaCozinha;
    if Usuario.cznchave = 0 then
      Exit;

    vpUsuario := false;
    if (Length(trim(EdtUsuario.Text)) > 0) and (Length(trim(EdtSenha.Text)) > 0) then
    begin
      // Autenticando usuários
      MainModule.UniMainModule.clb.Close;
      MainModule.UniMainModule.clb.Params[0].AsString := EdtUsuario.Text;
      MainModule.UniMainModule.clb.Params[1].AsString := EdtSenha.Text;
      MainModule.UniMainModule.clb.Open;

      // verificando se usuário digitou a senha corretamente
      if MainModule.UniMainModule.clb.RecordCount = 1 then
      begin
        // carregando dados do usuário no objeto
        Usuario.clbcodigo := MainModule.UniMainModule.clbclbcodigo.AsInteger;
        Usuario.clbidentificacao := MainModule.UniMainModule.clbclbidentificacao.AsString;
        MainmForm.Caption := 'Pégasus Gourmet Mobile                   ( ' + MainModule.UniMainModule.clbclbidentificacao.AsString + ' )';
        vpUsuario := true;
        CarregaMesa;

        MostraTab(TabMesa);
      end
      else
      begin
        MainmForm.Caption := 'Pégasus Gourmet Mobile';
        MessageDlg('Usuário ou Senha inválido !', mtWarning, [mbOK], nil);
        EdtUsuario.Clear;
        EdtSenha.Clear;
        EdtUsuario.SetFocus;
      end;
    end
    else
    begin
      MessageDlg('Favor informar' + #13 + 'Nome do Usuario e Senha !', mtWarning, [mbOK], nil);
      MainmForm.Caption := 'Pégasus Gourmet Mobile';
    end;
  end
  else
  begin
    ShowMessage('Não foi possível abrir Conexão verifique as configurações no arquivo Gourmeterp.ini' + #13 + 'em : ' + ExtractFilePath(ParamSTR(0)));
    Exit;
  end;
end;

procedure TMainmForm.BtnMostraItemClick(Sender: TObject);
begin
  if BtnTabPedPedido.Tag = 1 then
  begin
    if not MainModule.UniMainModule.vtItens.IsEmpty then
      ApresentaItem(MainModule.UniMainModule.orcorcchave.AsInteger, MainModule.UniMainModule.vtItensitochave.AsInteger);

  end
  else
  begin

    ApresentaPreItem;

  end;

end;

procedure TMainmForm.btnTabPedConfirmaClick(Sender: TObject);
VAR
  vlNumeroMesa: String;
  vlItoChave: string;
begin
  vlNumeroMesa := '0';

  with MainModule.UniMainModule do
  begin
    UniMainModule.cfg.Close;
    UniMainModule.cfg.Connection := UniMainModule.Conexao;
    UniMainModule.cfg.Open;
  end;

  btnTabPedConfirma.Enabled := false;
  if btnTabPedConfirma.Tag in [0, 2] then
  begin

    MainModule.UniMainModule.dVtiItens.DataSet.First;
    while not MainModule.UniMainModule.dVtiItens.DataSet.Eof do
    begin
      vlItoChave := MainModule.UniMainModule.dVtiItens.DataSet.fieldbyname('itochave').AsString;

      MainModule.UniMainModule.dVtiItens.DataSet.Next;
    end;

    if MainModule.UniMainModule.cfgcfgmgouqtdmesas.AsInteger > 0 then
    begin
      MainModule.UniMainModule.Consulta.Close;
      MainModule.UniMainModule.Consulta.SQL.Text := 'select orcmesa from orc where orcchave= ' + MainModule.UniMainModule.orcorcchave.AsString;
      MainModule.UniMainModule.Consulta.Open;

      if (MainModule.UniMainModule.Consulta.fieldbyname('orcmesa').AsString = '0') and (EdtLocal.Text <> '0') then
      begin
        vpNumeroMesa := EdtLocal.Text;

        MainModule.UniMainModule.SQL('update orc set orcmesa=' + vpNumeroMesa + ' , orcpessoas = ''' + FormatFloat('###000', EdtPedQtde.Value) +
          ''' where orcchave = ' + MainModule.UniMainModule.orcorcchave.AsString);
        EdtLocal.Text := '0';
      end;

    end;

    if (EdtPedQtde.Value > 0) and (btnTabPedConfirma.Tag = 2) then
      MainModule.UniMainModule.SQL('update orc set orcmesa=' + vpNumeroMesa + ' , orcpessoas = ''' + FormatFloat('###000', EdtPedQtde.Value) +
        ''' where orcchave = ' + MainModule.UniMainModule.orcorcchave.AsString);
    ConfirmaItens;
  end
  else if btnTabPedConfirma.Tag = 1 then
  begin
    if not MainModule.UniMainModule.vtItens.IsEmpty then
      MessageDlg('Deseja encerrar essa mesa ?', mtConfirmation, mbYesNo, DCallBackEncerraMesa)
    else
      btnTabPedConfirma.Enabled := true;
  end
  else
  begin
    btnTabPedConfirma.Enabled := true;
  end;

  AjustaPaineldeMesas(true);
end;

procedure TMainmForm.BtnTabPedPedidoClick(Sender: TObject);
begin
  if BtnTabPedPedido.Tag = 0 then
  begin
    SolicitaFechamento;
  end
  else if BtnTabPedPedido.Tag = 1 then
  begin
    Comanda;
  end;

end;

procedure TMainmForm.BtnVerificaCozinhaClick(Sender: TObject);
begin
  VerificaCozinha;
end;

procedure TMainmForm.CarregaMesa;
var
  vNome: String;
  vPos: integer;
  vCont: integer;
  vQtdPanel: integer;
  vpanel: TUnimPanel;
  x: String;
  i: integer;
  y: integer;
begin
  // Calculando quantidade de paineis para disposição das mesa

  try
    vpLargura := Usuario.QtdColulas;
  except
    vpLargura := 1000;
  end;

  i := 4;

  vQtdPanel := (Usuario.QtdMesa div i);

  if (Usuario.QtdMesa mod i) > 0 then
    vQtdPanel := vQtdPanel + 1;

  vPos := 1;
  vpMesaGer := 0;
  while vPos <= vQtdPanel do
  begin
    // Criadno Botões para apresentação das mesas
    for vCont := 0 to vScrollBox.ControlCount - 1 do
    begin
      x := (vScrollBox.Controls[vCont] as TUnimPanel).Name;
      if (vScrollBox.Controls[vCont] as TUnimPanel).Name = 'PnMesa' + IntToStr(vPos) then
        GeraMessa((vScrollBox.Controls[vCont] as TUnimPanel), vQtdPanel, vPos);
    end;
    vPos := vPos + 1;
  end;
end;

procedure TMainmForm.Comanda;
begin
  if not MainModule.UniMainModule.orc.IsEmpty then
  begin
    LimpaTotal;
    MainModule.UniMainModule.vtItens.Clear;
    btnTabPedConfirma.Caption := 'Confirma';
    btnTabPedConfirma.Tag := 0;
    // LbPedQtde.Caption := 'Pessoas ';
    EdtPedQtde.Value := MainModule.UniMainModule.orcorcpessoas.AsInteger;
    BtnTabPedPedido.Tag := 0;
    BtnTabPedPedido.Caption := 'Pedido';
    PnModoPessoas.Visible := false;
    btnTabPedConfirma.Enabled := true;
    BtnPedPessoa.Visible := true;

  end;
end;

procedure TMainmForm.ConfirmaItens;
begin
  EnviaItens;
  btnTabPedConfirma.Enabled := true;
  btnTabPedConfirma.Tag := 0;
  PnModoPessoas.Visible := false;
  MostraTab(TabMesa);
end;

procedure TMainmForm.DCallBackAbandonaMesa(Sender: TComponent; Res: integer);
begin
  if Res = idYes then
    MostraTab(TabMesa);
end;

procedure TMainmForm.DCallBackEncerraMesa(Sender: TComponent; Res: integer);
var
  vPessoas: integer;
begin
  if Res = idYes then
  begin
    if EdtPedQtde.Value > 1 then
      vPessoas := StrToInt(EdtPedQtde.Text)
    else
      vPessoas := 1;

    MainModule.UniMainModule.SQL('update orc set clbencerrou='+Usuario.clbcodigo.ToString+',  orcimpressao=0, stocodigo  = 5 , orcpessoas = ' + IntToStr(vPessoas) + ', clbvendedor = ' +
      IntToStr(Usuario.clbcodigo) + '  where orcchave = ' + MainModule.UniMainModule.orcorcchave.AsString);
    btnTabPedConfirma.Enabled := true;
    btnTabPedConfirma.Tag := 0;
    PnModoPessoas.Visible := false;
    MostraTab(TabMesa);
  end
  else
    Comanda;
end;

procedure TMainmForm.DCallBackExcluirItem(Sender: TComponent; Res: integer);
var
  vlPosicao: integer;
  vlPosicaoAnterior: integer;
  vlPosicaoAjustada: integer;

begin
  if Res = idYes then
  begin

    if MainModule.UniMainModule.vtItensStatus.AsInteger = 0 then
    begin

      if MainModule.UniMainModule.vtItens.locate('itoitem', vpId, []) then
      begin
        UniMainModule.tisi.First;
        while not UniMainModule.tisi.Eof do
        begin
          if UniMainModule.tisisfnid.AsInteger = MainModule.UniMainModule.vtItensitoitem.AsInteger then
            UniMainModule.tisi.Delete
          else
            UniMainModule.tisi.Next;
        end;

        MainModule.UniMainModule.vtItens.Delete;
      end;
    end;
  end;
  vlPosicaoAnterior := 0;
  vlPosicaoAjustada := 1;
  MainModule.UniMainModule.vtItens.First;
  while not MainModule.UniMainModule.vtItens.Eof do
  begin
    vlPosicaoAnterior := MainModule.UniMainModule.vtItensitoitem.AsInteger;

    UniMainModule.tisi.First;
    while not UniMainModule.tisi.Eof do
    begin
      if UniMainModule.tisiisiitem.AsInteger = vlPosicaoAnterior then
      begin
        UniMainModule.tisi.Edit;
        UniMainModule.tisiisiitem.AsInteger := vlPosicaoAjustada;
        UniMainModule.tisi.Post;
      end;
      UniMainModule.tisi.Next;
    end;

    MainModule.UniMainModule.vtItens.Edit;
    MainModule.UniMainModule.vtItensitoitem.AsInteger := vlPosicaoAjustada;
    MainModule.UniMainModule.vtItens.Post;

    if not UniMainModule.Item.IsEmpty then
    begin
      if UniMainModule.Item.locate('itoitem', vlPosicaoAnterior, []) then
      begin
        UniMainModule.Item.Edit;
        UniMainModule.Itemitoitem.AsInteger := vlPosicaoAjustada;
        UniMainModule.Item.Post;
      end;
    end;

    if not UniMainModule.itemBorda.IsEmpty then
    begin
      if UniMainModule.itemBorda.locate('itoitem', vlPosicaoAnterior, []) then
      begin
        UniMainModule.itemBorda.Edit;
        UniMainModule.ItemBordaitoitem.AsInteger := vlPosicaoAjustada;
        UniMainModule.itemBorda.Post;
      end;
    end;

    if not UniMainModule.itemSabor.IsEmpty then
    begin
      if UniMainModule.itemSabor.locate('itoitem', vlPosicaoAnterior, []) then
      begin
        UniMainModule.itemSabor.Edit;
        UniMainModule.ItemSaboritoitem.AsInteger := vlPosicaoAjustada;
        UniMainModule.itemSabor.Post;
      end;
    end;

    if not UniMainModule.ItemIngredientefra.IsEmpty then
    begin
      if UniMainModule.ItemIngredientefra.locate('itoitem', vlPosicaoAnterior, []) then
      begin
        UniMainModule.ItemIngredientefra.Edit;
        UniMainModule.ItemIngredienteFraitoitem.AsInteger := vlPosicaoAjustada;
        UniMainModule.ItemIngredientefra.Post;
      end;
    end;

    if not UniMainModule.ItemIngredienteNormal.IsEmpty then
    begin
      if UniMainModule.ItemIngredienteNormal.locate('itoitem', vlPosicaoAnterior, []) then
      begin
        UniMainModule.ItemIngredienteNormal.Edit;
        UniMainModule.ItemIngredienteNormalitoitem.AsInteger := vlPosicaoAjustada;
        UniMainModule.ItemIngredienteNormal.Post;
      end;
    end;

    if not UniMainModule.fIngrediente.IsEmpty then
    begin
      if UniMainModule.fIngrediente.locate('itoitem', vlPosicaoAnterior, []) then
      begin
        UniMainModule.fIngrediente.Edit;
        UniMainModule.fIngredienteitochave.AsInteger := vlPosicaoAjustada;
        UniMainModule.fIngrediente.Post;
      end;
    end;

    if not UniMainModule.vtfIng.IsEmpty then
    begin
      if UniMainModule.vtfIng.locate('sfnid', vlPosicaoAnterior, []) then
      begin
        UniMainModule.vtfIng.Edit;
        UniMainModule.vtfingsfnid.AsInteger := vlPosicaoAjustada;
        UniMainModule.vtfIng.Post;
      end;
    end;

    vlPosicaoAjustada := vlPosicaoAjustada + 1;

    MainModule.UniMainModule.vtItens.Next;
  end;

end;

procedure TMainmForm.EnviaItens;
begin
  with MainModule.UniMainModule do
  begin
    UniMainModule.tito.Open;

    if UniMainModule.vtItens.RecordCount > 0 then
    begin
      UniMainModule.vtItens.DisableControls;
      UniMainModule.vtItens.First;
      while not UniMainModule.vtItens.Eof do
      begin
        // verifica se o item não foi enviado para cozinha
        if UniMainModule.vtItensStatus.AsInteger = 0 then
        begin
          UniMainModule.Consulta.Close;
          UniMainModule.Consulta.SQL.Text := 'select  procodigo from pun where puncodigo=' + UniMainModule.vtItenspuncodigo.AsString;
          UniMainModule.Consulta.Open;

          if UniMainModule.Consulta.RecordCount = 1 then
          begin
            if UniMainModule.vtItensprocodigo.AsInteger <> UniMainModule.Consulta.fieldbyname('procodigo').AsInteger then
            begin
              UniMainModule.vtItens.Edit;
              UniMainModule.vtItensprocodigo.AsInteger := UniMainModule.Consulta.fieldbyname('procodigo').AsInteger;
              UniMainModule.vtItens.Post;

            end;

          end;

          UniMainModule.tito.Append;
          UniMainModule.titoprocodigo.AsInteger := UniMainModule.vtItensprocodigo.AsInteger;
          UniMainModule.titopuncodigo.AsInteger := UniMainModule.vtItenspuncodigo.AsInteger;
          UniMainModule.titoclbcodigo.AsInteger := Usuario.clbcodigo;
          UniMainModule.titoqtde.AsFloat := UniMainModule.vtItensitoquantidade.AsFloat;
          UniMainModule.titopessoas.AsInteger := 0;
          UniMainModule.titoobs.AsString := UniMainModule.vtItensObs.AsString;
          UniMainModule.titosfnid.AsInteger := UniMainModule.vtItensitoitem.AsInteger;
          UniMainModule.titosfncodigo.AsInteger := UniMainModule.vtItenssfncodigo.AsInteger;
          MainModule.UniMainModule.titocopos.AsInteger := MainModule.UniMainModule.vtItenscopos.AsInteger;
          MainModule.UniMainModule.titopratos.AsInteger := MainModule.UniMainModule.vtItenspratos.AsInteger;
          UniMainModule.tito.Post;
        end;
        UniMainModule.vtItens.Next;
      end;

      if UniMainModule.tito.RecordCount > 0 then
      begin
        UniMainModule.tito.ApplyUpdates;

        // gravando saberes e ingredients
        if UniMainModule.tisi.active then
          UniMainModule.tisi.ApplyUpdates;

        // borda produtos fracionados
        if UniMainModule.tbrd.active then
          UniMainModule.tbrd.ApplyUpdates;

        UniMainModule.MobGravaItens.Close;
        UniMainModule.MobGravaItens.Params[0].AsInteger := UniMainModule.orcorcchave.AsInteger;
        UniMainModule.MobGravaItens.Params[1].AsInteger := Usuario.clbcodigo;
        UniMainModule.MobGravaItens.Params[2].AsInteger := 1;
        UniMainModule.MobGravaItens.Params[3].AsInteger := 1; // tipo 1 tablets
        UniMainModule.MobGravaItens.ExecProc;
        if UniMainModule.MobGravaItens.Fields[0].AsInteger = 0 then
        begin

          UniMainModule.vtItens.Clear
        end
        else
          MessageDlg(UniMainModule.MobGravaItens.Fields[1].AsString, mtWarning, [mbOK], nil);
      end;
      UniMainModule.vtItens.EnableControls;
    end;
    UniMainModule.tito.Close;
  end;
end;

procedure TMainmForm.EventoBtnClick(Sender: TObject);
var
  vNumMesa: integer;
  vContador: integer;
  vTotal: Extended;
begin
  AjustaPaineldeMesas(false);

  vNumMesa := 0;
  if (Sender is TUnimBitBtn) then
  begin
    // (Sender as TUnimBitBtn).Enabled := false;
    // mesa do pedido
    vNumMesa := (Sender as TUnimBitBtn).Tag;

    if vNumMesa > 0 then
    begin

      UniMainModule.orc.Close;
      UniMainModule.orc.Params[0].AsInteger := vNumMesa;
      UniMainModule.orc.Open;

      if not UniMainModule.orc.IsEmpty then
      begin
        if UniMainModule.orcstocodigo.AsInteger = 5 then
        begin
          ShowMessage('Mesa em processo de fechamento, favor aguardar um instante !');
          Exit;
        end;
      end;

      MainModule.UniMainModule.trm.Close;
      MainModule.UniMainModule.trm.Open;

      if MainModule.UniMainModule.trm.locate('trmmesavendarapida', vNumMesa, []) then
      begin
        ShowMessage('Atenção, essa mesa é reservada para uso no caixa!' + #13 + #13 + ' Favor selecionar outra mesa!' + #13 + #13);
        Exit;

      end
      else
      begin

        // buscando pedido da mesa
        with MainModule.UniMainModule do
        begin
          UniMainModule.unm.Close;
          UniMainModule.unm.Params[0].AsInteger := vNumMesa;
          UniMainModule.unm.Open;

          if not UniMainModule.unm.IsEmpty then
          begin
            MessageDlg('Atenção, mesa unida à ' + UniMainModule.unmorcmesa.AsString, TMsgDlgType.mtInformation, mbAbortIgnore) ;
            Exit;
          end;

          // verifica se existe pedido aberto para mesa
          UniMainModule.orc.Close;
          UniMainModule.orc.Params[0].AsInteger := vNumMesa;
          UniMainModule.orc.Open;
          // caso não existe abre orcamento
          if UniMainModule.orc.IsEmpty then
          begin
            UniMainModule.MobAbreMesa.Close;
            UniMainModule.MobAbreMesa.Params[0].AsInteger := 0; // etdcodigo
            UniMainModule.MobAbreMesa.Params[1].AsInteger := Usuario.clbcodigo; // clbcodigo
            UniMainModule.MobAbreMesa.Params[2].AsInteger := 5; // moccodigo
            UniMainModule.MobAbreMesa.Params[3].AsInteger := vNumMesa; // moccodigo
            UniMainModule.MobAbreMesa.Params[4].AsInteger := 1; // moccodigo
            UniMainModule.MobAbreMesa.Params[5].AsInteger := 1; // moccodigo

            UniMainModule.MobAbreMesa.ExecProc;
            // buscando pedido gerado para mesa
            if UniMainModule.MobAbreMesa.Params[4].AsInteger > 0 then
            begin
              UniMainModule.orc.Close;
              UniMainModule.orc.Params[0].AsInteger := vNumMesa;
              UniMainModule.orc.Open;
            end
            else
            begin
              MessageDlg('Não foi possível abrir essa mesa verifique com a gerência !', mtWarning, [mbOK], nil);
              Exit;
            end;
          end;

          if UniMainModule.orcstocodigo.AsInteger = 5 then
          begin
            ShowMessage('Mesa em processo de fechamento, Não é possível gerar novas comanda !');
            Exit;
          end;

          // informando mesa do pedido
          LbMesa.Caption := Usuario.TituloOperador + ' ' + (Sender as TUnimBitBtn).Caption;
          PnModoPessoas.Visible := false;

          // itens do pedido
          if not UniMainModule.vtItens.active then
            UniMainModule.vtItens.Open
          else
            UniMainModule.vtItens.Clear;

          // produtos fracionados
          if not UniMainModule.vtpro.active then
            UniMainModule.vtpro.Open
          else
            UniMainModule.vtpro.Clear;

          // borda de produtos
          UniMainModule.tbrd.Close;
          UniMainModule.tbrd.Open;

          UniMainModule.tisi.Close;
          UniMainModule.tisi.Open;

          // mudando a TAB do btnPedConfirma para 1 que trata do envio dos pedidos
          Comanda;
          MostraTab(TabPedido);

        end;

        SolicitaFechamento;

      end;

    end
    else
    begin
      MessageDlg('Atenção Não foi possível abrir a mesa !', mtWarning, [mbOK], nil);
    end;

    // (Sender as TUnimBitBtn).Enabled := true;

  end;
end;

procedure TMainmForm.GeraMessa(Panel: TUnimPanel; QtdPanel, Posi: integer);
var
  vBtn: TUnimBitBtn;
  vQtdBtn: integer;
  vPos: integer;
  vQtd: integer;
  i: integer;
begin

  vpLargura := Self.Width;
  vpAltura := Self.Height;

  // if vpLargura < 600 then

  if vpLargura > vpAltura then
    vQtd := 10
  else
    vQtd := 4;
  // else
  // vQtd := 5;

  // verificando quantidades de mesas por painel
  if Posi < QtdPanel then
    vQtdBtn := vQtd
  else
  begin
    // Virificando a quantidade de mesas do ultimo painel
    if (Usuario.QtdMesa mod vQtd) = 0 then
      vQtdBtn := vQtd
    else
    begin
      // caso as mesas não são exatas gera
      // penas as mesas restantes
      if (vQtd + 1) > ((Posi * vQtd) - Usuario.QtdMesa) then
        vQtdBtn := vQtd - ((Posi * vQtd) - Usuario.QtdMesa)
      else
        vQtdBtn := vQtd;
    end;
  end;
  // gerando as mesas no painel atual
  with MainModule.UniMainModule do
  begin
    UniMainModule.cfg.Close;
    UniMainModule.cfg.Connection := UniMainModule.Conexao;
    UniMainModule.cfg.Open;
  end;

  vPos := 1;
  while vPos <= vQtdBtn do
  begin
    if vpMesaGer < MainModule.UniMainModule.cfgcfgmgouqtdmesas.AsInteger then
    begin

      vpMesaGer := vpMesaGer + 1;
      if Self.FindComponent('BtnMesa' + IntToStr(Posi) + IntToStr(vPos)) <> nil then
        TUnimBitBtn(Self.FindComponent('BtnMesa' + IntToStr(Posi) + IntToStr(vPos))).Destroy;

      vBtn := TUnimBitBtn.Create(Self);
      vBtn.Caption := '</br>' + IntToStr(vpMesaGer) + '</br>' + '</br>';

      vBtn.AlignWithMargins := true;

      vBtn.Width := Round(vpLargura / vQtd);

      Panel.Height := vBtn.Width;

      vBtn.Parent := Panel;

      vBtn.AlignWithMargins := true;
      vBtn.Name := 'BtnMesa' + IntToStr(Posi) + IntToStr(vPos); // IntToStr(QryDC_Resposta.RecNo);
      vBtn.Tag := vpMesaGer;

      if vpLargura > vpAltura then
        vBtn.Font.Size := 30
      else
        vBtn.Font.Size := Round(Panel.Height * 0.30);

      UnimDBGridPedidos.Columns[0].Font.Size := Round(vBtn.Font.Size * 0.50);
      UnimDBGridPedidos.Columns[0].Font.Size := Round(vBtn.Font.Size * 0.50);

      UnimDBGridPedidos.Columns[1].Font.Size := Round(vBtn.Font.Size * 0.50);
      UnimDBGridPedidos.Columns[1].Font.Size := Round(vBtn.Font.Size * 0.50);

      UnimDBGridPedidos.Columns[2].Font.Size := Round(vBtn.Font.Size * 0.50);
      UnimDBGridPedidos.Columns[2].Font.Size := Round(vBtn.Font.Size * 0.50);

      UnimDBGridPedidos.Columns[3].Font.Size := Round(vBtn.Font.Size * 0.50);
      UnimDBGridPedidos.Columns[3].Font.Size := Round(vBtn.Font.Size * 0.50);

      UnimDBGridPedidos.Columns[4].Font.Size := Round(vBtn.Font.Size * 0.50);
      UnimDBGridPedidos.Columns[4].Font.Size := Round(vBtn.Font.Size * 0.50);

      vBtn.Top := 0;
      vBtn.Height := Panel.Height - 2;
      vBtn.Margins.Top := 0;
      vBtn.Margins.Bottom := 0;

      vBtn.Left := ((vPos * vBtn.Width) + 4) - vBtn.Width;

      vBtn.OnClick := EventoBtnClick;
      vBtn.ClientEvents.Enabled := true;

    end;

    vPos := vPos + 1;
  end;

end;

procedure TMainmForm.MostraTab(Tab: TUnimTabSheet);
var
  vCont: integer;
begin
  vpLargura := Self.Width;
  vpAltura := Self.Height;

  if vpAltura > 800 then
  begin
    GridTabCardGrupo.Font.Size := 22;
    GridTabCardTipoGrupo.Font.Size := 22;
    GridTabCardClasseGrupo.Font.Size := 22;
    // UnimDBGrid1.Columns[1].Width := 260;
    // UnimDBGridPedidos.Columns[1].Width := 260;
    // UnimDBGrid1.Font.Size := 22;
    UnimDBGridPedidos.Font.Size := 22;
    // UnimDBGrid1.Width := 450;
  end
  else
  begin
    GridTabCardGrupo.Font.Size := 16;
    GridTabCardTipoGrupo.Font.Size := 16;
    GridTabCardClasseGrupo.Font.Size := 16;
    // UnimDBGrid1.Columns[1].Width := 160;
    // UnimDBGridPedidos.Columns[1].Width := 160;
    // UnimDBGridPedidos.Columns[1].Width := 160;
    // UnimDBGrid1.Font.Size := 16;
    // UnimDBGrid1.Width := 350;

  end;

  TabCardOpcao.Enabled := false;
  TabCardGrp.Enabled := false;
  TabLogin.Enabled := false;
  TabMesa.Enabled := false;
  TabPedido.Enabled := false;

  // achões de showtab
  if Tab = TabMesa then
  begin
    // verificando se usuário esta logado
    if not vpUsuario then
    begin
      MostraTab(TabLogin);
      Exit;
    end;
  end
  else
    // limpando campo de usuário e senha
    if Tab = TabLogin then
    begin
      vpUsuario := false;
      EdtSenha.Clear;
      EdtUsuario.SetFocus;
    end;

  Tab.Enabled := true;
  TabPanel.ActivePage := Tab;

  if Tab = TabCardGrp then
  begin
    AbreCardapio;

  end;

  if Tab = TabPedido then
  begin

    { if Usuario.QtdColulas > 400 then
      begin
      lbdividir.Visible := true;
      UnimDBGridPedidos.Columns[2].Width := 250;
      end
      else
      begin
      UnimDBGridPedidos.Columns[2].Width := 120;

      end; }

    if lowercase(Usuario.TituloOperador) <> 'mesa' then
    begin
      plLocal.Visible := true;

    end

    else
    begin
      plLocal.Visible := false;
    end;





    // BtTabPedRetonoMesa.Left:=1;
    // BtTabPedRetonoMesa.Top:=3;
    // BtTabPedRetonoMesa.Height:=plTopoPedido.Height-2;

    // BtTabPedRetonoLogin.Left:= BtTabPedRetonoMesa.Left+BtTabPedRetonoMesa.Width+4;
    // BtTabPedRetonoLogin.Top:=BtTabPedRetonoMesa.top;
    // BtTabPedRetonoLogin.Height:=BtTabPedRetonoMesa.Height;

    // lbMesa.Left:=BtTabPedRetonoLogin.Left+BtTabPedRetonoLogin.Width+2;
    // lbMesa.Top:=10;
    // lbMesa.Height:=plTopoPedido.Height-12;

    // lbMesa.Width:=50;

    // BtnMostraItem.Top:=3;
    // BtnMostraItem.Height:=plTopoPedido.Height-2;
    // BtnMostraItem.Left:= lbMesa.Left+lbMesa.Width+2;

  end;

  VerificaMesa;
end;

procedure TMainmForm.SolicitaFechamento;
var
  vTotal: Extended;
  vRecebimentos: Extended;
  vDesconto: Extended;
begin
  // carregando todos os itens do pediso

  with MainModule.UniMainModule do
  begin
    // persistindo itens qua ainda não foram enviados para a cozinha
    EnviaItens;

    // abrindo tarefas
    if not UniMainModule.vtItens.active then
      UniMainModule.vtItens.Open
    else
      UniMainModule.vtItens.Clear;

    // buscando itens do orçamento
    UniMainModule.ito.Close;
    UniMainModule.ito.Params[0].AsInteger := UniMainModule.orcorcchave.AsInteger;
    UniMainModule.ito.Open;
    vTotal := 0;
    vRecebimentos := 0;
    vDesconto := 0;
    // Carregando itens da mesa
    if not UniMainModule.ito.IsEmpty then
    begin

      try
        MainModule.UniMainModule.Conexao.StartTransaction;

        UniMainModule.ito.First;
        while not UniMainModule.ito.Eof do
        begin
          UniMainModule.vtItens.Append;
          UniMainModule.vtItensitoitem.AsInteger := UniMainModule.itoitoitem.AsInteger;
          UniMainModule.vtItensitoquantidade.AsFloat := UniMainModule.itoitoquantidade.AsFloat;
          UniMainModule.vtItensprocodigo.AsInteger := UniMainModule.itoprocodigo.AsInteger;
          UniMainModule.vtItenspronome.AsString := UniMainModule.itopronome.AsString;
          UniMainModule.vtItensunisimbolo.AsString := UniMainModule.itounisimbolo.AsString;
          UniMainModule.vtItenspuncodigo.AsInteger := UniMainModule.itopuncodigo.AsInteger;
          UniMainModule.vtItensStatus.AsInteger := 1;
          UniMainModule.vtItenstipo.AsInteger := 0;
          UniMainModule.vtItensitochave.AsInteger := UniMainModule.itoitochave.AsInteger;
          UniMainModule.vtItenspratos.AsInteger := 0;
          UniMainModule.vtItenscopos.AsInteger := 0;
          UniMainModule.vtItenshoraimprimiu.AsString := UniMainModule.itoimmhoraimpresso.AsString;

          UniMainModule.vtItens.Post;
          vTotal := vTotal + UniMainModule.itoitototalav.AsFloat;

          UniMainModule.Consulta.Close;
          UniMainModule.Consulta.SQL.Text := 'update imm set immmodo=1 where itochave=' + UniMainModule.itoitochave.AsString;
          UniMainModule.Consulta.ExecSQL;

          UniMainModule.ito.Next;
        end;
        MainModule.UniMainModule.Conexao.Commit;
      except
        MainModule.UniMainModule.Conexao.Rollback;
        Exit;

      end;

      // buscando dados de pagamentos
      UniMainModule.olt.Close;
      UniMainModule.olt.Params[0].AsInteger := UniMainModule.orcorcchave.AsInteger;
      UniMainModule.olt.Open;

      // calculando valores recebidos
      if not UniMainModule.olt.IsEmpty then
      begin
        UniMainModule.olt.First;
        while not UniMainModule.olt.Eof do
        begin
          if UniMainModule.olttipobaixa.AsInteger = 1 then
          begin
            vDesconto := vDesconto + UniMainModule.oltltedesconto.AsFloat;
            vRecebimentos := vRecebimentos + UniMainModule.oltltetotal.AsFloat;
          end;
          UniMainModule.olt.Next;
        end;
      end;

    end;

    with MainModule.UniMainModule do
    begin
      UniMainModule.cfg.Close;
      UniMainModule.cfg.Connection := UniMainModule.Conexao;
      UniMainModule.cfg.Open;
    end;

    // LbGeral.Caption := FormatFloat('#,##0.00', vTotal);
    LbTotal.Caption := FormatFloat('#,##0.00', (vTotal - vDesconto));
    // LbDesconto.Caption := FormatFloat('#,##0.00', vDesconto);
    LbRecebido.Caption := FormatFloat('#,##0.00', vRecebimentos);
    LbFalta.Caption := FormatFloat('#,##0.00', ((vTotal - vDesconto) - vRecebimentos));
    LbTotalTaxa.Caption := FormatFloat('#,##0.00', (vTotal - vDesconto) +
      ((vTotal - vDesconto) * (UniMainModule.cfgcfgmgoutaxaatendimento.AsFloat / 100)));

  end;

  // mudando a TAG do btnPedConfirma para 1 que trata do encerramento do pedido
  BtnPedPessoa.Visible := false;
  // LbPedQtde.Caption := 'Dividir por ';
  EdtPedQtde.Value := 1;
  btnTabPedConfirma.Caption := 'Encerrar';
  btnTabPedConfirma.Tag := 1;
  PnModoPessoas.Visible := true;
  BtnTabPedPedido.Tag := 1;
  BtnTabPedPedido.Caption := 'Comanda';

end;

procedure TMainmForm.TabPanelChange(Sender: TObject);
var
  vlLargura: integer;

begin

  if TabPanel.ActivePage = TabCardOpcao then
  begin
    (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := '';
  end
  else if TabPanel.ActivePage = TabMesa then
  begin
    AjustaPaineldeMesas(true);
  end
  else
  begin
    AjustaPaineldeMesas(false);
  end;
end;

procedure TMainmForm.TextoProdutoEnter(Sender: TObject);
begin
  TextoProduto.Text := '';

end;

procedure TMainmForm.LimpaTotal;
begin
  // LbGeral.Caption := FormatFloat('#,##0.00', 0);
  LbTotal.Caption := FormatFloat('#,##0.00', 0);
  // LbDesconto.Caption := FormatFloat('#,##0.00', 0);
  LbRecebido.Caption := FormatFloat('#,##0.00', 0);
  LbFalta.Caption := FormatFloat('#,##0.00', 0);
  LbTotalTaxa.Caption := FormatFloat('#,##0.00', 0);
end;

procedure TMainmForm.BtnTabPedQtdeMaisClick(Sender: TObject);
begin
  EdtPedQtde.Value := EdtPedQtde.Value + 1;
end;

procedure TMainmForm.BtTabPedExcluirItemClick(Sender: TObject);
begin

  try
    AjustaPaineldeMesas(true);
    BtTabPedExcluirItem.Enabled := false;

    if not MainModule.UniMainModule.vtItens.IsEmpty then
    begin

      UnimDBGridPedidosClick(UnimDBGridPedidos);
      vpId := UnimDBGridPedidos.DataSource.DataSet.fieldbyname('itoitem').AsInteger;

      if MainModule.UniMainModule.vtItensStatus.AsInteger = 1 then
      begin
        ShowMessage('Este item já foi solicitado para cozinha, Cancelamento somente no caixa !');
        vpId := 0;
      end
      else
      begin
        MessageDlg('Deseja excluir o item ?', mtConfirmation, mbYesNo, DCallBackExcluirItem);
      end;
    end
    else
    begin
      ShowMessage('Não existem itens na comanda, não é possível excluir!');
      vpId := 0;
    end;
  finally
    BtTabPedExcluirItem.Enabled := true;
  end;
end;

procedure TMainmForm.BtTabCardRetonoClick(Sender: TObject);
begin
  if GridTabCardTipoGrupo.Visible then
  begin

    GridTabCardGrupo.Visible := false;
    GridTabCardTipoGrupo.Visible := false;
    GridTabCardClasseGrupo.Visible := true;

  end
  else if GridTabCardClasseGrupo.Visible then
  begin
    GridTabCardGrupo.Visible := false;
    GridTabCardTipoGrupo.Visible := false;
    GridTabCardClasseGrupo.Visible := false;
    MostraTab(TabPedido);
  end
  else if GridTabCardGrupo.Visible then
  begin
    GridTabCardGrupo.Visible := false;
    GridTabCardTipoGrupo.Visible := false;
    GridTabCardClasseGrupo.Visible := true;

    { GridTabCardGrupo.Visible := False;
      GridTabCardTipoGrupo.Visible := False;
      GridTabCardClasseGrupo.Visible := False; }

    // MostraTab(TabPedido);

  end;

end;

procedure TMainmForm.BtTabMesaRetornoClick(Sender: TObject);
begin
  MostraTab(TabLogin);
end;

procedure TMainmForm.BtTabOpcaoIncluirItemClick(Sender: TObject);
var
  vItem: integer;
  vlclasse: integer;
  vlTpo: integer;
  vlGrupo: integer;
begin

  BtTabOpcaoIncluirItem.Enabled := false;

  edBuscaItem.Text := '';

  fIncluir.Caption := LbCardapio.Caption;

  With MainModule.UniMainModule do
  begin
    if UniMainModule.vtItens.active then
    begin
      // caso exista registro em aberto cancela
      UniMainModule.vtItens.Cancel;

      vItem := (UniMainModule.vtItens.RecordCount + 1);

      // iniciando inclusão de novo registro
      UniMainModule.vtItens.Append;
      UniMainModule.vtItensitoitem.AsInteger := vItem;
      UniMainModule.vtItensitoquantidade.AsFloat := 1;
      UniMainModule.vtItensprocodigo.AsInteger := UniMainModule.procprocodigo.AsInteger;
      UniMainModule.vtItenspronome.AsString := UniMainModule.procpronomereduzido.AsString;
      UniMainModule.vtItenscopos.AsInteger := 0;
      UniMainModule.vtItenspratos.AsInteger := 0;

      // abrindo a tabela de preços
      UniMainModule.pun.Close;
      UniMainModule.pun.Params[0].AsInteger := UniMainModule.procprocodigo.AsInteger;
      UniMainModule.pun.Open;

      UniMainModule.bpr.Close;
      UniMainModule.bpr.Params[0].AsInteger := UniMainModule.procprocodigo.AsInteger;
      UniMainModule.bpr.Open;

      if UniMainModule.bpr.RecordCount = 0 then
      begin
        fIncluir.PnQtde.Visible := false;
      end
      else
      begin
        fIncluir.PnQtde.Visible := true;
      end;

      fIncluir.lbUnidade.Caption := UniMainModule.pununisimbolo.AsString;
      if UniMainModule.pununisimbolo.AsString = 'KG' then
      begin
        fIncluir.lbUnidade.Caption := 'GR';
        UniMainModule.vtItensitoquantidade.AsString := '';
      end
      else
      begin
        fIncluir.lbUnidade.Caption := UniMainModule.pununisimbolo.AsString;
        UniMainModule.vtItensitoquantidade.AsString := '1';
      end;

    end;
  end;

  fIncluir.ShowFormModal(
    procedure
    Begin
      if MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString = 'KG' then
      begin
        fIncluir.lbUnidade.Caption := 'GR';
        // fIncluir.UnimDBEdit1.Field.AsString := '';
      end
      else
      begin
        fIncluir.lbUnidade.Caption := MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString;
        // fIncluir.UnimDBEdit1.Field.AsString := '1';
      end;

      if fIncluir.vpIncluir = 0 then
        MostraTab(TabPedido)
      else if fIncluir.vpIncluir = 1 then
      begin
        if MainModule.UniMainModule.cgr.RecordCount >= 1 then
        begin

          vlclasse := MainModule.UniMainModule.cgrcgrcodigo.AsInteger;
          vlTpo := MainModule.UniMainModule.tgrtgrcodigo.AsInteger;
          vlGrupo := MainModule.UniMainModule.grpgrpcodigo.AsInteger;

          MostraTab(TabCardGrp);

        end
        else
        begin

          MostraTab(TabCardGrp);
        end;

      end
      else if fIncluir.vpIncluir = 2 then
      begin
        if MainModule.UniMainModule.vtItens.State <> dsbrowse then
        begin
          MainModule.UniMainModule.vtItens.Cancel;
        end
        else
        begin
          MainModule.UniMainModule.vtItens.Delete;
        end;
      end
      else if fIncluir.vpIncluir = 3 then
      begin
        if MainModule.UniMainModule.cgr.RecordCount >= 1 then
        begin

          vlclasse := MainModule.UniMainModule.cgrcgrcodigo.AsInteger;
          vlTpo := MainModule.UniMainModule.tgrtgrcodigo.AsInteger;
          vlGrupo := MainModule.UniMainModule.grpgrpcodigo.AsInteger;

          MostraTab(TabCardGrp);

          MainModule.UniMainModule.cgr.locate('cgrcodigo', vlclasse, []);
          GridTabCardClasseGrupoClick(GridTabCardClasseGrupo);

          { MainModule.UniMainModule.tgr.locate('tgrcodigo', vlTpo, []);
            GridTabCardTipoGrupoClick(GridTabCardTipoGrupo); }

          MainModule.UniMainModule.grp.locate('grpcodigo', vlGrupo, []);
          GridTabCardGrupo1Click(GridTabCardGrupo);

        end
        else
        begin

          MostraTab(TabCardGrp);
        end;

      end;
    end);
 (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := '';

  BtTabOpcaoIncluirItem.Enabled := true;
end;

procedure TMainmForm.BtTabOpcaoRetornoClick(Sender: TObject);
begin
  BtTabOpcaoRetorno.Enabled := false;
  if (MainModule.UniMainModule.vtItens.State = dsInsert) then
    MainModule.UniMainModule.vtItens.Post;
  MostraTab(TabCardGrp);
  (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := '';
  BtTabOpcaoRetorno.Enabled := true;
end;

procedure TMainmForm.BtTabPedRetonoMesaClick(Sender: TObject);
begin

  VerificaMesa;
  if (not MainModule.UniMainModule.vtItens.IsEmpty) and (btnTabPedConfirma.Tag in [0, 2]) then
    MessageDlg('Existem itens que não foram enviados para cozinha, Deseja Cancelar ?', mtConfirmation, mbYesNo, DCallBackAbandonaMesa)
  else
  begin
    AjustaPaineldeMesas(true);
    MostraTab(TabMesa);
  end;
end;

procedure TMainmForm.btTransferirmesaClick(Sender: TObject);
begin
  fTrnasfereMesa.ShowFormModal(
    procedure
    Begin
    end);

end;

procedure TMainmForm.BtTabPedIncluirItemClick(Sender: TObject);
var
  vItem: integer;
  vpode: boolean;
  vlENumero: integer;
begin
  try
    AjustaPaineldeMesas(true);
    BtTabPedIncluirItem.Enabled := false;

    if BtnTabPedPedido.Tag = 1 then
      Comanda;

    if not BtnPedPessoa.Visible then
      BtnPedPessoa.Visible := false;

    // verificando se a cozinha esta aberta
    VerificaCozinha;

    // chamando o cardápio
    LbMesaCard.Caption := LbMesa.Caption;

    UniMainModule.cgr.Close;
    UniMainModule.cgr.Open;

    if UniMainModule.cgr.RecordCount >= 1 then
    begin
      GridTabCardGrupo.Visible := false;
      GridTabCardClasseGrupo.Visible := true;
    end;

    AbreCardapio;

    try
      vlENumero := StrToInt(TextoProduto.Text);
    except
      TextoProduto.Text := '';

    end;

    if (TextoProduto.Text <> '') and (TextoProduto.Text <> '0') then
    begin

      MainModule.UniMainModule.Consulta.Close;
      MainModule.UniMainModule.Consulta.SQL.Text := 'select grpcodigo from pro where procodigo=' + TextoProduto.Text;
      MainModule.UniMainModule.Consulta.Open;

      if MainModule.UniMainModule.Consulta.IsEmpty then
      begin
        ShowMessage('Código de Produto INVÁLIDO!');
        TextoProduto.Text := '';
        // mostrando os itens de cardápio
        MostraTab(TabPedido);

      end
      else
      begin

        vpode := false;

        fIncluir.Caption := LbCardapio.Caption;
        With MainModule.UniMainModule do
        begin

          UniMainModule.Consulta.Close;
          UniMainModule.Consulta.SQL.Text := 'select grpcodigo from pro where procodigo=' + TextoProduto.Text;
          UniMainModule.Consulta.Open;

          if not UniMainModule.Consulta.IsEmpty then
          begin

            UniMainModule.proc.Close;
            UniMainModule.proc.ParamByName('grpcodigo').AsString := UniMainModule.Consulta.fieldbyname('grpcodigo').AsString;
            UniMainModule.proc.Open;

            if UniMainModule.proc.locate('procodigo', TextoProduto.Text, []) then
            begin
              vpode := true;
              if UniMainModule.vtItens.active then
              begin
                // caso exista registro em aberto cancela
                UniMainModule.vtItens.Cancel;

                vItem := (UniMainModule.vtItens.RecordCount + 1);

                // iniciando inclusão de novo registro
                UniMainModule.vtItens.Append;
                UniMainModule.vtItensitoitem.AsInteger := vItem;
                UniMainModule.vtItensitoquantidade.AsFloat := 1;
                UniMainModule.vtItensprocodigo.AsInteger := UniMainModule.procprocodigo.AsInteger;
                UniMainModule.vtItenspronome.AsString := UniMainModule.procpronomereduzido.AsString;

                UniMainModule.vtItenscopos.AsInteger := 0;
                UniMainModule.vtItenspratos.AsInteger := 0;

                // abrindo a tabela de preços
                UniMainModule.pun.Close;
                UniMainModule.pun.Params[0].AsInteger := UniMainModule.procprocodigo.AsInteger;
                UniMainModule.pun.Open;
                vpode := true;
                TextoProduto.Text := '';
                fIncluir.TabPanelInc.ActivePage := fIncluir.TabItem;
                fIncluir.TabItem.TabVisible := true;

              end;
            end
            else
            begin
              ShowMessage('Código de Produto INVÁLIDO!');
              TextoProduto.Text := '';
              vpode := false;
              Exit;
            end;
          end
          else
          begin
            ShowMessage('Código de Produto INVÁLIDO!');
            TextoProduto.Text := '';
            vpode := false;
            Exit;
          end;

        end;
        if TextoProduto.Text = '' then
          Exit;

        if TextoProduto.Text <> '' then
        begin
          // abrindo a tabela de preços
          MainModule.UniMainModule.pun.Close;
          MainModule.UniMainModule.pun.Params[0].AsInteger := MainModule.UniMainModule.procprocodigo.AsInteger;
          MainModule.UniMainModule.pun.Open;

          fIncluir.ShowFormModal(
            procedure
            Begin

              if MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString = 'KG' then
              begin
                fIncluir.lbUnidade.Caption := 'GR';
                // fIncluir.UnimDBEdit1.Field.AsString := '';
              end
              else
              begin
                fIncluir.lbUnidade.Caption := MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString;
                // fIncluir.UnimDBEdit1.Field.AsString := '1';
              end;

              if fIncluir.vpIncluir = 0 then
                MostraTab(TabPedido)
              else if fIncluir.vpIncluir = 1 then
                MostraTab(TabCardGrp)
              else if fIncluir.vpIncluir = 2 then
                MainModule.UniMainModule.vtItens.Cancel;
            end);

        end
        else
        begin

        end;

      end;
    end
    else
    begin
      // mostrando os itens de cardápio
      MostraTab(TabCardGrp);
    end;
  finally
    BtTabPedIncluirItem.Enabled := true;

  end;

end;

procedure TMainmForm.BtTabPedRetonoLoginClick(Sender: TObject);
begin
  if (not MainModule.UniMainModule.vtItens.IsEmpty) and (btnTabPedConfirma.Tag in [0, 2]) then
    MessageDlg('Existem itens que não foram enviados para cozinha, Deseja Cancelar ?', mtConfirmation, mbYesNo, DCallBackAbandonaMesa)
  else
    MostraTab(TabLogin);
end;



procedure TMainmForm.BtnTabPedQtdeMenosClick(Sender: TObject);
begin
  EdtPedQtde.Value := EdtPedQtde.Value - 1;
end;

procedure TMainmForm.GridTabCardGrupo1Click(Sender: TObject);
begin
  with MainModule.UniMainModule do
  begin
    if not UniMainModule.grp.IsEmpty then
    begin
      // verifica se o produto é facionado
      UniMainModule.sfn.Close;
      UniMainModule.sfn.Params[0].AsInteger := UniMainModule.grpgrpcodigo.AsInteger;
      UniMainModule.sfn.Open;
      // caso o produto não seja facionado abre aba de opções do grupo
      if UniMainModule.sfn.IsEmpty then
      begin
        UniMainModule.proc.Close;
        UniMainModule.proc.Params[0].AsInteger := UniMainModule.grpgrpcodigo.AsInteger;
        UniMainModule.proc.Open;
        if UniMainModule.proc.IsEmpty then
        begin
          MessageDlg('Opções de Cardapio não Disponível, verifica se existe impressora definida para esse Grupo !', mtWarning, [mbOK], nil);
          Exit;
        end
        else
        begin
          LbCardapio.Caption := UniMainModule.grpgrpidentificacao.AsString;
          MostraTab(TabCardOpcao);
        end;
      end
      else
      // caso o produto seja fracionado abre formulario de produtos facionados
      begin
        // chama produto fracionado
        IncluirItemFracionado;
      end;
    end;
  end;

end;

procedure TMainmForm.GridTabCardGrupoDrawColumnCell(Sender: TObject; ACol, ARow: integer; Column: TunimDBGridColumn; Attribs: TUniCellAttribs);
begin
  { if ACol = 0 then
    Attribs.Style.Cls:= 'myShadowStyle' // style is defined in file "files/mycss.css"
    else if ACol = 2 then
    Attribs.Style.Padding := '0px';    // force image to fit in the cell }
end;

procedure TMainmForm.IncluirItemFracionado;
begin
  // Carregando cardapio de produtos facionados
  FIncluirFracionado.Caption := MainModule.UniMainModule.grpgrpidentificacao.AsString;
  MainModule.UniMainModule.brd.Close;
  MainModule.UniMainModule.brd.Params[0].AsInteger := MainModule.UniMainModule.grpgrpcodigo.AsInteger;
  MainModule.UniMainModule.brd.Open;

  FIncluirFracionado.BtnBordas.Visible := (not MainModule.UniMainModule.brd.IsEmpty);

  FIncluirFracionado.ShowFormModal(
    procedure
    Begin
      if FIncluirFracionado.vpConfirma = true then
        MostraTab(TabPedido)
      else
        MostraTab(TabCardGrp);
    end);
end;

procedure TMainmForm.BtnPedPessoaClick(Sender: TObject);
begin
  PnModoPessoas.Visible := true;
  btnTabPedConfirma.Tag := 2;
end;

procedure TMainmForm.GridTabCardTipoGrupoClick(Sender: TObject);
begin
  MostraItensGrupo;
end;

procedure TMainmForm.GridTabCardClasseGrupoClick(Sender: TObject);
begin
  MostraCardapio;
end;

procedure TMainmForm.UnimBitBtn1Click(Sender: TObject);
begin
  Self.VerificaMesa;
end;

procedure TMainmForm.UnimBitBtnObsClick(Sender: TObject);
begin
  fobs.ShowFormModal(
    procedure
    Begin

    end);
end;

procedure TMainmForm.UnimDBGridPedidosClick(Sender: TObject);
begin
  vpId := UnimDBGridPedidos.DataSource.DataSet.fieldbyname('itoitem').AsInteger;

end;

procedure TMainmForm.UnimDBGridPedidosDblClick(Sender: TObject);
var
  vItem: integer;
begin
  { (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := '';
    edBuscaItem.Text := '';

    fIncluir.Caption := LbCardapio.Caption;

    With MainModule.UniMainModule do
    begin
    if UniMainModule.vtItens.Active then
    begin
    // caso exista registro em aberto cancela
    UniMainModule.vtItens.Cancel;

    vItem := (UniMainModule.vtItens.RecordCount + 1);

    // iniciando inclusão de novo registro
    UniMainModule.vtItens.Edit;

    // abrindo a tabela de preços
    UniMainModule.pun.Close;
    UniMainModule.pun.Params[0].AsInteger := UniMainModule.procprocodigo.AsInteger;
    UniMainModule.pun.Open;

    fIncluir.lbUnidade.Caption := UniMainModule.pununisimbolo.AsString;
    fIncluir.EdtItemObs.Text := UniMainModule.vtItensObs.AsString;
    if UniMainModule.pununisimbolo.AsString = 'KG' then
    begin
    fIncluir.lbUnidade.Caption := 'GR';
    UniMainModule.vtItensitoquantidade.AsString := '';
    end
    else
    begin
    fIncluir.lbUnidade.Caption := UniMainModule.pununisimbolo.AsString;
    end;

    end;
    end;

    fIncluir.ShowFormModal(
    procedure
    Begin
    if MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString = 'KG' then
    begin
    fIncluir.lbUnidade.Caption := 'GR';
    // fIncluir.UnimDBEdit1.Field.AsString := '';
    end
    else
    begin
    fIncluir.lbUnidade.Caption := MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString;
    // fIncluir.UnimDBEdit1.Field.AsString := '1';
    end;

    if fIncluir.vpIncluir = 0 then
    MostraTab(TabPedido)
    else if fIncluir.vpIncluir = 1 then
    MostraTab(TabCardGrp)
    else if fIncluir.vpIncluir = 2 then
    MainModule.UniMainModule.vtItens.Cancel;
    end);
  }
end;

procedure TMainmForm.UnimDBListGrid1DblClick(Sender: TObject);
var
  vItem: integer;
begin
  (MainModule.UniMainModule.dproc.DataSet as tuniquery).FilterSQL := '';
  edBuscaItem.Text := '';

  fIncluir.Caption := LbCardapio.Caption;

  With MainModule.UniMainModule do
  begin
    if UniMainModule.vtItens.active then
    begin
      // caso exista registro em aberto cancela
      UniMainModule.vtItens.Cancel;

      vItem := (UniMainModule.vtItens.RecordCount + 1);

      // iniciando inclusão de novo registro
      UniMainModule.vtItens.Edit;

      // abrindo a tabela de preços
      UniMainModule.pun.Close;
      UniMainModule.pun.Params[0].AsInteger := UniMainModule.procprocodigo.AsInteger;
      UniMainModule.pun.Open;

      fIncluir.lbUnidade.Caption := UniMainModule.pununisimbolo.AsString;
      fIncluir.EdtItemObs.Text := UniMainModule.vtItensObs.AsString;
      if UniMainModule.pununisimbolo.AsString = 'KG' then
      begin
        fIncluir.lbUnidade.Caption := 'GR';
        UniMainModule.vtItensitoquantidade.AsString := '';
      end
      else
      begin
        fIncluir.lbUnidade.Caption := UniMainModule.pununisimbolo.AsString;
      end;

    end;
  end;

  fIncluir.ShowFormModal(
    procedure
    Begin
      if MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString = 'KG' then
      begin
        fIncluir.lbUnidade.Caption := 'GR';
        // fIncluir.UnimDBEdit1.Field.AsString := '';
      end
      else
      begin
        fIncluir.lbUnidade.Caption := MainModule.UniMainModule.dpun.DataSet.fieldbyname('unisimbolo').AsString;
        // fIncluir.UnimDBEdit1.Field.AsString := '1';
      end;

      if fIncluir.vpIncluir = 0 then
        MostraTab(TabPedido)
      else if fIncluir.vpIncluir = 1 then
        MostraTab(TabCardGrp)
      else if fIncluir.vpIncluir = 2 then
        MainModule.UniMainModule.vtItens.Cancel;
    end);

end;

procedure TMainmForm.UnimFormScreenResize(Sender: TObject; AWidth, AHeight: integer);
var
  l: integer;
begin

  if vpAltura = 0 then
    vpAltura := AHeight;
  vpLargura := AWidth;

  l := Round(vpLargura / 2);

  LbVersao.Caption := 'Mobile: 23.27.211.1';

  Usuario.QtdColulas := vpLargura;

  try
    vpLargura := AWidth;
  except
    vpLargura := 1000;
  end;

  if vpAltura = 0 then
    vpAltura := AHeight;

  l := Round(vpLargura / 2);

  EdtUsuario.Left := l - Round(EdtUsuario.Width / 2);
  EdtSenha.Left := EdtUsuario.Left;
  BtnLoginConfirmar.Left := EdtUsuario.Left;

end;

procedure TMainmForm.UnimFormShow(Sender: TObject);
begin
  MainModule.UniMainModule.Theme := 'classic';
  // MainModule.UniMainModule.TouchTheme := 'neptune';
  // MainModule.UniMainModule.TouchTheme := 'neptune';

  MainmForm.Scaled := true;

  TabMesa.Caption := MainModule.UniMainModule.vpTituloOperador;

  if MainModule.UniMainModule.Conexao.Connected then
  begin
    EdtUsuario.Text := '';
    EdtSenha.Text := '';

    // Mostrando tabMesa
    Usuario.QtdMesa := MainModule.UniMainModule.vpQtdeMesas;
    Usuario.TituloOperador := MainModule.UniMainModule.vpTituloOperador;
    Usuario.tsicodigo := 3;


    // CarregaMesa;

    // Ativando Tab de Login
    MostraTab(TabLogin);
    VerificaCozinha;
  end
  else
  begin
    ShowMessage('Não foi possível abrir Conexão verifique as configurações no arquivo Gourmeterp.Ini' + #13 + 'em : ' + ExtractFilePath(ParamSTR(0)));
    Exit;
  end;
end;

Function SoNumeros(Const Texto: String): String;

//
// Remove caracteres de uma string deixando apenas numeros
//
Var
  i: integer;
  S: String;
Begin
  S := '';
  For i := 1 To Length(Texto) Do
  Begin
    If (Texto[i] In ['0' .. '9']) Then
    Begin
      S := S + copy(Texto, i, 1);
    End;
  End;
  Result := S;
End;

procedure TMainmForm.VerificaMesa;
var
  vPos: integer;
  vLin: integer;
  i, x: integer;

  vPosPanel: integer;
  vpanel: TUnimPanel;

  vlnome: string;
begin

  vScrollBox.Enabled := false;
  MainModule.UniMainModule.msaocupada.Close;
  MainModule.UniMainModule.msaocupada.Open;

  for i := 1 to 50 do
  begin
    for x := 1 to 5 do
    begin
      try
        if (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) <> nil) then
        begin
          if (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) is TUnimBitBtn) then
          begin
            vlnome := SoNumeros((Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Caption);

            if MainModule.UniMainModule.msaocupada.locate('orcmesa',
              SoNumeros((Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Caption), []) then
            begin
              if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [1] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clblack;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
              end
              else if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [2] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := $00FF8000;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;

              end
              else if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [99] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clGreen;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;

              end
              else if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [5] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clred;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
              end

              else
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clblack;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
              end;
            end
            else
            begin
              (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clblack;
              (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
            end;
          end;
        end;
      except

      end;

    end;
  end;

  for i := 1 to 50 do
  begin
    for x := 1 to 10 do
    begin
      try
        if (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) <> nil) then
        begin
          if (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) is TUnimBitBtn) then
          begin
            vlnome := SoNumeros((Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Caption);

            if MainModule.UniMainModule.msaocupada.locate('orcmesa',
              SoNumeros((Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Caption), []) then
            begin
              if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [1] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clblack;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
              end
              else if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [2] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := $00FF8000;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;

              end
              else if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [99] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clGreen;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;

              end
              else if MainModule.UniMainModule.msaocupadastocodigo.AsInteger in [5] then
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clred;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
              end

              else
              begin
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clblack;
                (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
              end;
            end
            else
            begin
              (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Font.Color := clblack;
              (Self.FindComponent('BtnMesa' + IntToStr(i) + IntToStr(x)) as TUnimBitBtn).Repaint;
            end;
          end;
        end;
      except

      end;

    end;
  end;



  vScrollBox.Enabled := true;
end;

procedure TMainmForm.VerificaCozinha;
begin
  if MainModule.UniMainModule.Conexao.Connected then
  begin
    // verificando se existe abertura de cozinha em aberto
    if MainModule.UniMainModule.ConsultaSQL('select cznchave from czn where cznfechamento IS null order by cznchave limit 1') then
    begin
      Usuario.cznchave := MainModule.UniMainModule.Consulta.Fields[0].AsInteger;
      LbLoginMensagem.Visible := false;
      BtnLoginConfirmar.Enabled := true;
      PnMensagemCozinha.Visible := false;
    end
    else
    begin
      Usuario.cznchave := 0;
      BtnLoginConfirmar.Enabled := false;
      LbLoginMensagem.Visible := true;
      PnMensagemCozinha.Visible := true;
      MostraTab(TabLogin);
    end;
  end
  else
  begin
    ShowMessage('Não foi possível abrir Conexão verifique as configurações no arquivo Gourmeterp.Ini' + #13 + 'em : ' + ExtractFilePath(ParamSTR(0)));
    Exit;
  end;
end;

initialization

RegisterAppFormClass(TMainmForm);

end.
