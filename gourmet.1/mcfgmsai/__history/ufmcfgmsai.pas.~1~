unit ufmcfgmsai;

interface

uses
  Winapi.Windows, Vcl.Forms, ufrmbase, Vcl.Dialogs, Vcl.StdCtrls, Vcl.DBCtrls,
  Vcl.Mask, Vcl.ImgList, Vcl.Controls, PngImageList, System.Classes,
  System.Actions, Vcl.ActnList, Data.DB, MemDS, DBAccess, Uni, Vcl.Buttons,
  Vcl.ComCtrls, Vcl.ExtCtrls, System.SysUtils, uPegaBase, System.ImageList;
type
  Tfmcfgmsai = class(Tfrmbase)
    Dtoe: tunidatasource;
    toe: tuniquery;
    toetoecodigo: TIntegerField;
    toetoeidentificacao: TStringField;
    registrocfgcodigo: TIntegerField;
    registrocfgpercomismed: TIntegerField;
    registrocfgdoisprecos: TIntegerField;
    registrocfgusamultiplicador: TIntegerField;
    registrocfgvndlimitcre: TIntegerField;
    registrocfgtipocomissao: TIntegerField;
    registrocfgpedeoperador: TIntegerField;
    registrocfgidentificaequip: TIntegerField;
    registrocfgbalanca: TIntegerField;
    registrocfgnrseriepro: TIntegerField;
    registrocfgrefepro: TIntegerField;
    registrocfgcompro: TIntegerField;
    registrocfgunitrib: TIntegerField;
    registrocfgtoecuffora: TIntegerField;
    registrocfgtoecufinte: TIntegerField;
    Label2: TLabel;
    cfgvndlimitcre: TDBEdit;
    Label3: TLabel;
    cfgpedeoperador: TDBEdit;
    Label7: TLabel;
    cfgidentificaequip: TDBEdit;
    sen: tuniquery;
    sensencodigo: TIntegerField;
    sensenidentificacao: TStringField;
    registrosendoisprecos: TStringField;
    registrosenvndlimitcre: TStringField;
    registrosenpedeoperador: TStringField;
    registrosennrseriepro: TStringField;
    registrosenrefepro: TStringField;
    registrosenunitrib: TStringField;
    registrosenidentificaequip: TStringField;
    registrosencompro: TStringField;
    registrosenbalanca: TStringField;
    registrosenpercomismed: TStringField;
    registrosenusamultiplicador: TStringField;
    registrocfgusafabricante: TIntegerField;
    registrosenusafabricante: TStringField;
    registrocfgmensagempdv: TStringField;
    registrocfgdefinetoeatendimento: TIntegerField;
    registrosendefinetoeatendimento: TStringField;
    Label24: TLabel;
    cfgdefinetoeatendimento: TDBEdit;
    registrocfgdefinecarpdv: TIntegerField;
    registrocfgtoemesfora: TIntegerField;
    registrocfgtoemesinte: TIntegerField;
    registrotoemesfora: TStringField;
    registrotoemesinte: TStringField;
    registrocfgprousaanpcodigo: TIntegerField;
    registrosenprousaanpcodigo: TStringField;
    Label12: TLabel;
    cfgusaveiculo: TDBEdit;
    registrocfgusaveiculo: TIntegerField;
    registrosencfgusaveiculo: TStringField;
    registrocfgusaenderecamento: TIntegerField;
    registrosencfgusaenderecamento: TStringField;
    registrocfgprocodigoauto: TIntegerField;
    registrosencopdigoauto: TStringField;
    Produtos: TTabSheet;
    Label1: TLabel;
    cfgdoisprecos: TDBEdit;
    Label5: TLabel;
    cfgrefepro: TDBEdit;
    Label6: TLabel;
    cfgunitrib: TDBEdit;
    Label8: TLabel;
    cfgcompro: TDBEdit;
    Label13: TLabel;
    cfgusafabricante: TDBEdit;
    Label4: TLabel;
    cfgusaenderecamento: TDBEdit;
    Label28: TLabel;
    cfgprousaanpcodigo: TDBEdit;
    Label29: TLabel;
    cfgprocodigoauto: TDBEdit;
    registrocfgprodefineicms: TIntegerField;
    registrocfgprousainfcompl: TIntegerField;
    registrosenprodefineicms: TStringField;
    registrosenprousainfcompl: TStringField;
    Label30: TLabel;
    cfgprodefineicms: TDBEdit;
    Label31: TLabel;
    cfgprousainfcompl: TDBEdit;
    registrocfgprousaetiqposi2010: TIntegerField;
    registrosenprousaetiqposi2010: TStringField;
    registrocfgcaminhotoledo: TStringField;
    registrocfgcaminhofilizola: TStringField;
    registrocfgcaminhoramuza: TStringField;
    OpenDialog: TOpenDialog;
    Etiquetas: TTabSheet;
    Balancas: TTabSheet;
    Label18: TLabel;
    cfgcaminhoramuza: TDBEdit;
    Label17: TLabel;
    cfgcaminhofilizola: TDBEdit;
    Label16: TLabel;
    cfgcaminhotoledo: TDBEdit;
    Label9: TLabel;
    cfgbalanca: TDBEdit;
    Label15: TLabel;
    cfgprousaetiqposi2010: TDBEdit;
    Label19: TLabel;
    cfgmodoatuapro: TDBEdit;
    registrocfgmodoatuapro: TIntegerField;
    btToledo: TSpeedButton;
    btFilizola: TSpeedButton;
    btRamuza: TSpeedButton;
    registrosemodoatuapro: TStringField;
    metidentificacao: TDBLookupComboBox;
    Label20: TLabel;
    registrometcodigo: TIntegerField;
    met: tuniquery;
    metmetcodigo: TIntegerField;
    metmetidentificacao: TStringField;
    registrometidentificacao: TStringField;
    Label21: TLabel;
    cfgcontrolaestoque: TDBEdit;
    registrocfgpedeclientevenda: TIntegerField;
    registrosenpedeclientevenda: TStringField;
    Label22: TLabel;
    cfgpedeclientevenda: TDBEdit;
    registrocfgcontrolaestoque: TIntegerField;
    registrocfgcontrolaestoquedisp: TIntegerField;
    Label23: TLabel;
    cfgcontrolaestoquedisp: TDBEdit;
    registrosencontrolasaldo: TStringField;
    registrosencontrolaestoquedisp: TStringField;
    btAjustarCodigoBalanca: TButton;
    Label32: TLabel;
    cpb: tuniquery;
    cpbcpbcodigo: TIntegerField;
    cpbprocodigo: TIntegerField;
    cpbcpbcodbalanca: TIntegerField;
    registrocfgsetorbalanca: TStringField;
    Label33: TLabel;
    cfgsetorbalanca: TDBEdit;
    registrocfgdigitosbalanca: TIntegerField;
    Label34: TLabel;
    cfgdigitosbalanca: TDBEdit;
    Label35: TLabel;
    btCriarCodigoBalanca: TButton;
    registrocfgidentificatecnico: TIntegerField;
    registrocfgusacaixaprevenda: TIntegerField;
    registrosenidentificatecnico: TStringField;
    registrosenusacaixaprevenda: TStringField;
    Label37: TLabel;
    cfgusacaixaprevenda: TDBEdit;
    registrocfgusagrade: TIntegerField;
    registrosenusagrade: TStringField;
    Label38: TLabel;
    cfgusagrade: TDBEdit;
    registrocfgidentificavendedor: TIntegerField;
    registrosenidentificavendedor: TStringField;
    registrocfgajustaperccomissao: TIntegerField;
    registrosenajustaperccomissao: TStringField;
    Label39: TLabel;
    cfgidentificavendedor: TDBEdit;
    cfgusavendaforaestab: TDBEdit;
    Label43: TLabel;
    registrocfgusavendaforaestab: TIntegerField;
    registrosenusavendaforaestab: TStringField;
    registrocfgtoetransflainte: TIntegerField;
    registrocfgtoetransflafora: TIntegerField;
    registrotoecfgtoetransflafora: TStringField;
    registrotoecfgtoetransflainte: TStringField;
    registrocfgusacstnoproduto: TIntegerField;
    registrosencfgusacstnoproduto: TStringField;
    cfgusacstnoproduto: TDBEdit;
    Label46: TLabel;
    cfgpercentacresaprazo: TDBEdit;
    lpcfgpercentacresaprazo: TLabel;
    registrocfgpercentacresaprazo: TFloatField;
    Label47: TLabel;
    cfgdescontonoservico: TDBEdit;
    registrocfgdescontonoservico: TIntegerField;
    registrosencfgdescontonoservico: TStringField;
    registrocfgformapagamento: TIntegerField;
    registrosencfgformapagamento: TStringField;
    Label48: TLabel;
    cfgformapagamento: TDBEdit;
    registrocfgtrocadevolucao: TIntegerField;
    registrosencfgtrocadevolucao: TStringField;
    Label49: TLabel;
    cfgtrocadevolucao: TDBEdit;
    registrocfgtoedevolconsum: TIntegerField;
    registrotoecfgtoedevolconsum: TStringField;
    registrocfgproinativsaldozero: TIntegerField;
    registrosencfgproinativsaldozero: TStringField;
    Label51: TLabel;
    cfgproinativsaldozero: TDBEdit;
    Dmet: TDataSource;
    registrocfgtoeconsumointerno: TIntegerField;
    registrotoecfgtoeconsumointerno: TStringField;
    registrocfgusatipogrupo: TIntegerField;
    registrosencfgusatipogrupo: TStringField;
    Label53: TLabel;
    cfgusatipogrupo: TDBEdit;
    registrocfgsalvatroco: TIntegerField;
    Label54: TLabel;
    cfgsalvatroco: TDBEdit;
    registrosencfgsalvatroco: TStringField;
    registrocfgformacancelamento: TIntegerField;
    registrosencfgformacancelamento: TStringField;
    Label55: TLabel;
    cfgformacancelamento: TDBEdit;
    registrocfgextratosegmentado: TIntegerField;
    registrosencfgextratosegmentado: TStringField;
    registrocfgetiquetabalanca: TIntegerField;
    cfgetiquetabalanca: TDBRadioGroup;
    registrocfgetdajusteestoque: TIntegerField;
    Label56: TLabel;
    cfgetdajusteestoque: TDBEdit;
    etd: TUniQuery;
    etdetdcodigo: TIntegerField;
    etdetdidentificacao: TStringField;
    registroetdcfgetdajusteestoque: TStringField;
    Label57: TLabel;
    cfgusaclassegrupo: TDBEdit;
    registrocfgusaclassegrupo: TIntegerField;
    registrosencfgusaclassegrupo: TStringField;
    registrocfgusagarantia: TIntegerField;
    registrosencfgusagarantia: TStringField;
    Label58: TLabel;
    cfgusagarantia: TDBEdit;
    registrocfgmostrapercentuais: TIntegerField;
    registrosencfgmostrapercentuais: TStringField;
    Label59: TLabel;
    cfgmostrapercentuais: TDBEdit;
    registrocfgusacsinoproduto: TIntegerField;
    registrocfgusacspnoproduto: TIntegerField;
    registrocfgusacsfnoproduto: TIntegerField;
    registrosencfgusacsinoproduto: TStringField;
    registrosencfgusacspnoproduto: TStringField;
    registrosencfgusacsfnoproduto: TStringField;
    Label60: TLabel;
    cfgusacsinoproduto: TDBEdit;
    Label61: TLabel;
    cfgusacspnoproduto: TDBEdit;
    Label62: TLabel;
    cfgusacsfnoproduto: TDBEdit;
    registrocfgabregaveta: TIntegerField;
    registrosencfgabregaveta: TStringField;
    Label63: TLabel;
    cfgabregaveta: TDBEdit;
    registrocfgusatabelaspreco: TIntegerField;
    registrosencfgusatabelaspreco: TStringField;
    Label64: TLabel;
    cfgusatabelaspreco: TDBEdit;
    registrocfgusaprecobase: TIntegerField;
    registrosencfgusaprecobase: TStringField;
    Label65: TLabel;
    cfgusaprecobase: TDBEdit;
    registrocfgpreconta: TIntegerField;
    registrocfgfotoproduto: TIntegerField;
    registrosencfgfotoproduto: TStringField;
    Label66: TLabel;
    cfgfotoproduto: TDBEdit;
    registrocfgtabelasaux: TIntegerField;
    registrosencfgtabelasaux: TStringField;
    Label67: TLabel;
    cfgtabelasaux: TDBEdit;
    registrocfgarredondapeso: TIntegerField;
    registrosencfgarredondapeso: TStringField;
    Label68: TLabel;
    cfgarredondapeso: TDBEdit;
    registrocfgusaafaturar: TIntegerField;
    registrosencfgusaafaturar: TStringField;
    Label71: TLabel;
    cfgusaafaturar: TDBEdit;
    Label72: TLabel;
    cfgprevisualizarimpressao: TDBEdit;
    registrocfgprevisualizarimpressao: TIntegerField;
    registrosencfgprevisualizarimpressao: TStringField;
    registrocfgtoenotacomplementar: TIntegerField;
    registrotoecfgtoenotacomplementar: TStringField;
    registrocfgtoesubstnoestado: TIntegerField;
    registrocfgtoesubstforaestado: TIntegerField;
    registrotoecfgtoesubstnoestado: TStringField;
    registrotoecfgtoesubstforaestado: TStringField;
    registrocfgregistraferramentas: TIntegerField;
    registrosencfgregistraferramentas: TStringField;
    Label75: TLabel;
    cfgregistraferramentas: TDBEdit;
    registrocfgusapromocao: TIntegerField;
    registrosencfgusapromocao: TStringField;
    Label76: TLabel;
    cfgusapromocao: TDBEdit;
    GBComissionamento: TGroupBox;
    Label42: TLabel;
    cfgajustaperccomissao: TDBEdit;
    Label36: TLabel;
    cfgidentificatecnico: TDBEdit;
    Label10: TLabel;
    cfgtipocomissao: TDBEdit;
    registrosencfgtipocomissao: TStringField;
    TabSheet1: TTabSheet;
    Label27: TLabel;
    cfgtoemesfora: TDBEdit;
    cfgtoemesinte: TDBEdit;
    Label26: TLabel;
    Label25: TLabel;
    cfgtoesubstnoestado: TDBEdit;
    cfgtoesubstforaestado: TDBEdit;
    Label74: TLabel;
    Label50: TLabel;
    cfgtoedevolconsum: TDBEdit;
    cfgtoeconsumointerno: TDBEdit;
    Label52: TLabel;
    Label44: TLabel;
    cfgtoetransflainte: TDBEdit;
    cfgtoetransflafora: TDBEdit;
    Label45: TLabel;
    Label73: TLabel;
    cfgtoenotacomplementar: TDBEdit;
    registrocfgtoeinteproducaopropria: TIntegerField;
    registrotoecfgtoeinteproducaopropria: TStringField;
    registrocfgtoeforaproducaopropria: TIntegerField;
    registrotoecfgtoeforaproducaopropria: TStringField;
    registrocfgproducaopropria: TIntegerField;
    registrosencfgproducaopropria: TStringField;
    cfgproducaopropria: TDBEdit;
    Label41: TLabel;
    cfgtoeinteproducaopropria: TDBEdit;
    Label69: TLabel;
    cfgtoeforaproducaopropria: TDBEdit;
    Label70: TLabel;
    registrocfgdiferencialaliquota: TIntegerField;
    registrosencfgdiferencialaliquota: TStringField;
    Label77: TLabel;
    cfgdiferencialaliquota: TDBEdit;
    Label78: TLabel;
    cfgpresencialtoedestino: TDBEdit;
    registrocfgpresencialtoedestino: TIntegerField;
    registrosencfgpresencialtoedestino: TStringField;
    registrocfgtoeintesubsprodpropria: TIntegerField;
    registrotoecfgtoeintesubsprodpropria: TStringField;
    registrocfgtoeforasubsprodpropria: TIntegerField;
    registrotoecfgtoeforasubsprodpropria: TStringField;
    Label79: TLabel;
    cfgtoeintesubsprodpropria: TDBEdit;
    Label80: TLabel;
    cfgtoeforasubsprodpropria: TDBEdit;
    procedure FormShow(Sender: TObject);
    procedure btToledoClick(Sender: TObject);
    procedure btFilizolaClick(Sender: TObject);
    procedure btRamuzaClick(Sender: TObject);
    procedure btAjustarCodigoBalancaClick(Sender: TObject);
    procedure btCriarCodigoBalancaClick(Sender: TObject);
    procedure registroAfterInsert(DataSet: TDataSet);
    procedure bconfirmaClick(Sender: TObject);
  private
    FCfgCodigo: Integer;
    { Private declarations }

  published
    property CfgCodigo: Integer read FCfgCodigo write FCfgCodigo;

  public
    { Public declarations }
  end;

var
  fmcfgmsai: Tfmcfgmsai;

  // Início ID do Módulo fracfgmsai
const
  vPlIdMd = '03.06.81.005-01';
  vPlTitMdl = 'Configurações Estoque - Saída';

  // Fim ID do Módulo fracfgmsai

implementation

{$R *.dfm}

function formulario(pCargaFrame: TCargaFrame): string;
begin
  fmcfgmsai := Tfmcfgmsai.Create(pCargaFrame);
  fmcfgmsai.ShowModal;
  fmcfgmsai.Free;
end;

exports formulario;

procedure Tfmcfgmsai.bconfirmaClick(Sender: TObject);
begin
  inherited;

  if registrocfgdiferencialaliquota.AsString = '1' then
  begin
    consulta.Close;
    consulta.SQL.Text := 'update pro set padcodigo=1';
    consulta.ExecSQL;
  end
  else
  begin
    consulta.Close;
    consulta.SQL.Text := 'update pro set padcodigo=0';
    consulta.ExecSQL;

  end;

end;

procedure Tfmcfgmsai.btAjustarCodigoBalancaClick(Sender: TObject);
begin
  inherited;

  If Application.MessageBox(PChar('Confirma a processo de REORDENAÇÃO dos códigos' + #13 + 'de balança para os produtos com unidade KG?'), 'Atenção',
    MB_YESNO + MB_DEFBUTTON1 + MB_ICONQUESTION) = IDYES Then
  Begin

    consulta.Close;
    consulta.sql.Text := 'update pro set probalanca=' + chr(39) + '1' + chr(39) + '  where unicodigo=2';
    consulta.ExecSQL;

    consulta.Close;
    consulta.sql.Text := 'update pro set probalanca=' + chr(39) + '0' + chr(39) + '  where unicodigo<>2';
    consulta.ExecSQL;

    consulta.Close;
    consulta.sql.Text := 'delete from cpb';
    consulta.ExecSQL;

    consulta.Close;
    consulta.sql.Text := 'select procodigo from pro where probalanca=' + chr(39) + '1' + chr(39) + ' order by procodigo';
    consulta.Open;

    cpb.Close;
    cpb.Open;
    while not consulta.Eof do
    begin
      cpb.Append;
      cpbprocodigo.AsInteger := consulta.Fields[0].AsInteger;
      cpbcpbcodbalanca.AsInteger := cpb.RecordCount + 1;
      cpb.Post;
      consulta.Next;
    end;
    showmessage('Processo de ajuste de códigos para balança realizado com sucesso!');

  End;
end;

procedure Tfmcfgmsai.btCriarCodigoBalancaClick(Sender: TObject);
begin
  inherited;

  If Application.MessageBox(PChar('Confirma a processo de CRIAÇÃO dos códigos' + #13 + 'de balança para os produtos com unidade KG?'), 'Atenção',
    MB_YESNO + MB_DEFBUTTON1 + MB_ICONQUESTION) = IDYES Then
  Begin

    { consulta.Close;
      consulta.sql.Text := 'update pro set probalanca=' + chr(39) + '1' + chr(39) + '  where unicodigo=2';
      consulta.ExecSQL;

      consulta.Close;
      consulta.sql.Text := 'update pro set probalanca=' + chr(39) + '0' + chr(39) + '  where unicodigo<>2';
      consulta.ExecSQL; }

    consulta.Close;
    consulta.sql.Text := 'delete from cpb';
    consulta.ExecSQL;

    consulta.Close;
    consulta.sql.Text := 'select procodigo from pro where probalanca=' + chr(39) + '1' + chr(39) + ' order by procodigo';
    consulta.Open;

    cpb.Close;
    cpb.Open;
    while not consulta.Eof do
    begin
      cpb.Append;
      cpbprocodigo.AsInteger := consulta.Fields[0].AsInteger;
      cpbcpbcodbalanca.AsInteger := consulta.Fields[0].AsInteger;
      cpb.Post;
      consulta.Next;
    end;
    showmessage('Processo de ajuste de códigos para balança realizado com sucesso!');

  End;

end;

procedure Tfmcfgmsai.btFilizolaClick(Sender: TObject);
begin
  inherited;
  OpenDialog.Execute();
  cfgcaminhofilizola.Field.AsString := extractfilepath(OpenDialog.FileName);

end;

procedure Tfmcfgmsai.btRamuzaClick(Sender: TObject);
begin
  inherited;
  OpenDialog.Execute();
  cfgcaminhoramuza.Field.AsString := extractfilepath(OpenDialog.FileName);

end;

procedure Tfmcfgmsai.btToledoClick(Sender: TObject);
begin
  inherited;
  OpenDialog.Execute();
  cfgcaminhotoledo.Field.AsString := extractfilepath(OpenDialog.FileName);
end;

procedure Tfmcfgmsai.FormShow(Sender: TObject);
begin
  IdModulo := vPlIdMd;

  CfgCodigo := StrToInt(vChaveMestre);
  registro.Params[0].AsInteger := CfgCodigo;

  inherited;

  toe.Open;

  if Self.Height < 610 then
    Self.Height := 610;
end;

procedure Tfmcfgmsai.registroAfterInsert(DataSet: TDataSet);
begin
  registrocfgcodigo.AsInteger := CfgCodigo;
end;

end.
