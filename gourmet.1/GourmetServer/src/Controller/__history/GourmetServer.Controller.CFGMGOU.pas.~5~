unit GourmetServer.Controller.CFGMGOU;

interface

Uses
  System.Json,
  System.SysUtils,
  idHashMessageDigest,
  GourmetServer.Controller.IMM,
  GourmetServer.Model.DAOGeneric,
  GourmetServer.Model.Entity.CFGMGOU;

function NovoNumeroPedidoCFG(vCznChave: integer): integer;
Function ManutencaoCFGMGOU(vcfgmgoupedidelivery: integer): integer;
Procedure ManutencaoStatusAIQ(vcfgcodigo: integer);

type
  TAPIError = class
  private
    Ferror: string;
  public
    property error: string read Ferror write Ferror;
  end;

implementation

procedure ManutencaoStatusAIQ(vcfgcodigo: integer);
var
  FDAO: iDAOGeneric<TCFGMGOUSTATUS>;
  FCFGMGOUSTATUS: TCFGMGOUSTATUS;
begin

  FDAO := TDAOGeneric<TCFGMGOUSTATUS>.New;
  FDAO.DAO.SQL.Fields('cfgcodigo,cfgmgoustatusaiq').where('cfgcodigo=' + vcfgcodigo.ToString).&End.Find;

  FCFGMGOUSTATUS := TCFGMGOUSTATUS.create;
  FCFGMGOUSTATUS.cfgcodigo := vcfgcodigo;
  FCFGMGOUSTATUS.cfgmgoustatusaiq := now();
  FDAO.DAO.Update(FCFGMGOUSTATUS);
end;

Function ManutencaoCFGMGOU(vcfgmgoupedidelivery: integer): integer;
var
  FDAO: iDAOGeneric<TCFGMGOU>;
  FCFGMGOU: TCFGMGOU;
  vlNumeroPedido: integer;
begin
  vlNumeroPedido := 0;

  FDAO := TDAOGeneric<TCFGMGOU>.New;

  FDAO.DAO.SQL.where('cfgcodigo=1').&End.Find;

  FCFGMGOU := TCFGMGOU.create;
  FCFGMGOU.cfgcodigo := 1;
  FCFGMGOU.cfgmgoupedidelivery := vcfgmgoupedidelivery;
  FDAO.DAO.Update(FCFGMGOU);

  FDAO.DAO.Find;
  vlNumeroPedido := FDAO.DataSet.FieldByName('cfgmgoupedidelivery').asInteger;
  result := vlNumeroPedido;

end;

function NovoNumeroPedidoCFG(vCznChave: integer): integer;
var
  vlNumeroPedido: integer;
begin

  vlNumeroPedido := BuscaNumeroUltimoPedido(vCznChave) + 1;
  ManutencaoCFGMGOU(vlNumeroPedido);
  result := vlNumeroPedido;

end;

end.
