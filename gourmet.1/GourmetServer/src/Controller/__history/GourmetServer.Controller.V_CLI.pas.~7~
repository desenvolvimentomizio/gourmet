unit GourmetServer.Controller.V_CLI;

interface

Uses

  System.Json,
  System.SysUtils,
  idHashMessageDigest,
  GourmetServer.Service.Funcoes,
  GourmetServer.Model.DAOGeneric,
  GourmetServer.Model.Entity.V_CLI;

function BuscaCodigoETD(vetftelefone: string; vetfcelular: string; veteemail: String; vetdidentificacao: string; vetddoc1:String): Integer;

type
  TAPIError = class
  private
    Ferror: string;
  public
    property error: string read Ferror write Ferror;
  end;

implementation


function BuscaCodigoETD(vetftelefone: string; vetfcelular: string; veteemail: String; vetdidentificacao: string; vetddoc1:String): Integer;
var
  FDAO: iDAOGeneric<TV_CLI>;
  vletdcodigo: Integer;
  VLString:string;
begin
  vletdcodigo := -1;

  FDAO := TDAOGeneric<TV_CLI>.New;
  if (sonumeros(vetddoc1)<>'')  then
  begin
     VLString:='(etddoc1=' + QuotedStr(sonumeros(vetddoc1)) + ')' ;
    writeln('Filtro de Localização: '+ VLString);

    FDAO.DAO.SQL.where(VLString).&End.Find;
  end
  else if sonumeros(vetftelefone)='' then
  begin
     VLString:='(etftelefone=' + QuotedStr(sonumeros(vetfcelular)) + ') or (eteemail=' +
      QuotedStr(veteemail) + ') and (etdidentificacao like ' +QuotedStr('%' +vetdidentificacao + '%')+')';
    FDAO.DAO.SQL.where(VLString).&End.Find;
  end
  else if sonumeros(vetfcelular)='' then
  begin
    VLString:='(etftelefone=' + QuotedStr(sonumeros(vetftelefone)) + ') or (eteemail=' +
      QuotedStr(veteemail) + ') and (etdidentificacao like ' +QuotedStr('%' +vetdidentificacao + '%')+')';
    FDAO.DAO.SQL.where(VLString).&End.Find;
  end
  else
  begin
    VLString:='(etftelefone=' + QuotedStr(sonumeros(vetftelefone)) + ') and (etftelefone=' + QuotedStr(sonumeros(vetfcelular)) + ') or (eteemail=' +
      QuotedStr(veteemail) + ') and (etdidentificacao like ' +QuotedStr('%' +vetdidentificacao + '%')+')';
    FDAO.DAO.SQL.where(VLString).&End.Find;

  end;
  writeln('Filstro de Localização: '+ VLString);

  vletdcodigo := FDAO.DataSet.FieldByName('etdcodigo').asInteger;

  result := vletdcodigo;
end;



end.
