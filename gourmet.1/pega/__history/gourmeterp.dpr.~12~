program gourmeterp;

uses
  madExcept,
  Vcl.Forms,
  System.SysUtils,
  Winapi.Windows,
  Vcl.Themes,
  System.Classes,
  Vcl.Styles,
  dialogs,
  Inifiles,
  uupgrade in '..\uupgrade.pas';

{$R *.res}

procedure SetMainForm(FormAtivo: TForm);
var
  TmpMain: ^TCustomForm;

begin
  TmpMain := @Application.MainForm;
  TmpMain^ := FormAtivo;
end;

procedure LoadMainForm;
type
  TMainForm = procedure(AOwner: TApplication);
var
  MainForm: TMainForm;
  Pack: HModule;
begin
  Pack := LoadPackage(pchar('mprincigourmet.bpl'));
  if Pack = 0 then
    exit;

  @MainForm := GetProcAddress(Pack, pchar('MainForm'));

  if Assigned(MainForm) then
    MainForm(Application);
end;

var
  vlPathBPL: String;
  vlPathModulos: String;
  vlPathDLL: String;
  vlForm: TForm;

begin
  vlPathBPL := ExtractFilePath(Application.ExeName) + 'BPLs;';
  vlPathModulos := ExtractFilePath(Application.ExeName) + 'Modulos;';
  vlPathDLL := ExtractFilePath(Application.ExeName) + 'DLLs;';
  SetEnvironmentVariable(PWideChar('PATH'), PWideChar(vlPathBPL + vlPathModulos + vlPathDLL));

  VerificarRelease;

  LoadMainForm;
  vlForm := TForm(Application.FindComponent('fprincigourmet'));
  SetMainForm(vlForm);
  Application.Run;

end.




