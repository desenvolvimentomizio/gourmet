unit ufigp;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmbase, System.ImageList, Vcl.ImgList, PngImageList, System.Actions, Vcl.ActnList, Data.DB, MemDS, DBAccess, Uni,
  Vcl.Buttons, Vcl.ComCtrls, Vcl.StdCtrls, Vcl.ExtCtrls, Vcl.Mask, Vcl.DBCtrls;

type
  Tfigp = class(Tfrmbase)
    registroprocodigo: TIntegerField;
    registropronome: TStringField;
    registropronomereduzido: TStringField;
    registromarcodigo: TIntegerField;
    registrogrpcodigo: TIntegerField;
    registrogrpidentificacao: TStringField;
    registrotrbcodigo: TIntegerField;
    registroicmcodigo: TStringField;
    registrounicodigo: TIntegerField;
    registrouninome: TStringField;
    registrotpocodigo: TIntegerField;
    registroprominimo: TFloatField;
    registroproproprio: TStringField;
    registropronumserie: TStringField;
    registroproncm: TStringField;
    registroprocomposto: TStringField;
    registroprobalanca: TStringField;
    registroprotecla: TStringField;
    registroprovalidade: TIntegerField;
    registroproestoque: TStringField;
    registroproobs: TStringField;
    registroproreferencia: TStringField;
    registroprounitrib: TIntegerField;
    registroproqtdtrib: TFloatField;
    registrosipcodigo: TIntegerField;
    registroproanpcodigo: TIntegerField;
    registroenpcodigo: TIntegerField;
    registropropedecomple: TIntegerField;
    registropropededescrserv: TIntegerField;
    registropropedetecnicoserv: TIntegerField;
    registrogracodigo: TIntegerField;
    registrodprcodigo: TIntegerField;
    registroprousagrade: TIntegerField;
    registrocstcodigo: TStringField;
    Label1: TLabel;
    procodigo: TDBEdit;
    Label2: TLabel;
    pronome: TDBEdit;
    Label3: TLabel;
    grpcodigo: TDBEdit;
    Label4: TLabel;
    unicodigo: TDBEdit;
    grp: TUniQuery;
    grpgrpcodigo: TIntegerField;
    grpgrpidentificacao: TStringField;
    Uni: TUniQuery;
    uniunicodigo: TIntegerField;
    uniuninome: TStringField;
    unituncodigo: TIntegerField;
    pun: TUniQuery;
    punpuncodigo: TIntegerField;
    punprocodigo: TIntegerField;
    pununicodigo: TIntegerField;
    pundgrcodigo: TIntegerField;
    punpunidentificacao: TStringField;
    pununicodigobase: TIntegerField;
    punpunmultiplicador: TFloatField;
    punpunquantidade: TFloatField;
    punpunprecoav: TFloatField;
    punpunprecoap: TFloatField;
    punpuncusto: TFloatField;
    punpunmargem: TFloatField;
    punpunpesobruto: TFloatField;
    punpunpesoliq: TFloatField;
    punpunbarra: TStringField;
    puntuncodigo: TIntegerField;
    punpununitrib: TIntegerField;
    punpunqtdtrib: TFloatField;
    punpunbarrasistema: TIntegerField;
    punpunmargemap: TFloatField;
    punpunpercacresavap: TFloatField;
    punpunbarraposi: TStringField;
    Dpun: TDataSource;
    Label5: TLabel;
    puncusto: TDBEdit;
    Label6: TLabel;
    punprecoav: TDBEdit;
    procedure registroAfterInsert(DataSet: TDataSet);
    procedure bconfirmaClick(Sender: TObject);
    procedure punBeforePost(DataSet: TDataSet);
    procedure punAfterInsert(DataSet: TDataSet);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  figp: Tfigp;

implementation

{$R *.dfm}

procedure Tfigp.bconfirmaClick(Sender: TObject);
begin

  if registro.State = dsbrowse then
    registro.Edit;

  registroprounitrib.AsString := registrounicodigo.AsString;
  registropronomereduzido.AsString := registropronome.AsString;
  registroproqtdtrib.AsFloat := 1;
  inherited;

  pun.Close;
  pun.ParamByName('procodigo').AsInteger := registroprocodigo.AsInteger;
  pun.Open;

  if pun.IsEmpty then
    pun.Append
  else
    pun.Edit;

  punprocodigo.AsInteger := registroprocodigo.AsInteger;
  pununicodigo.AsInteger := registrounicodigo.AsInteger;
  punpunidentificacao.AsString := '1xUN';
  pununicodigobase.AsInteger := registrounicodigo.AsInteger;
  punpunmultiplicador.AsFloat := 1;
  punpunquantidade.AsFloat := 1;
 // punpunprecoav.AsFloat := 0;
  punpunprecoap.AsFloat := 0;
 // punpuncusto.AsFloat := 0;
  punpunmargem.AsFloat := 0;
  punpunpesobruto.AsFloat := 0;
  punpunpesoliq.AsFloat := 0;
  punpunbarra.AsString := '';
  puntuncodigo.AsFloat := 1;
  punpununitrib.AsInteger := registrounicodigo.AsInteger;
  punpunqtdtrib.AsFloat := 1;
  punpunbarrasistema.AsFloat := 1;
  pundgrcodigo.AsInteger := 1;
  punpunmargemap.AsFloat := 0;
  punpunpercacresavap.AsFloat := 0;
  punpunbarraposi.AsString := '';

  pun.Post;

end;

procedure Tfigp.punAfterInsert(DataSet: TDataSet);
begin
  inherited;
  punpuncusto.AsFloat:=0;
  pununicodigo.AsInteger:=1;
end;

procedure Tfigp.punBeforePost(DataSet: TDataSet);
begin
  inherited;
  punprocodigo.AsInteger := registroprocodigo.AsInteger;
  pununicodigo.AsInteger := registrounicodigo.AsInteger;
  punpunidentificacao.AsString := '1xUN';
  pununicodigobase.AsInteger := registrounicodigo.AsInteger;
  punpunmultiplicador.AsFloat := 1;
  punpunquantidade.AsFloat := 1;
 // punpunprecoav.AsFloat := 0;
  punpunprecoap.AsFloat := 0;
 // punpuncusto.AsFloat := 0;
  punpunmargem.AsFloat := 0;
  punpunpesobruto.AsFloat := 0;
  punpunpesoliq.AsFloat := 0;
  punpunbarra.AsString := '';
  puntuncodigo.AsFloat := 1;
  punpununitrib.AsInteger := registrounicodigo.AsInteger;
  punpunqtdtrib.AsFloat := 1;
  punpunbarrasistema.AsFloat := 1;
  pundgrcodigo.AsInteger := 1;
  punpunmargemap.AsFloat := 0;
  punpunpercacresavap.AsFloat := 0;
  punpunbarraposi.AsString := '';
end;

procedure Tfigp.registroAfterInsert(DataSet: TDataSet);
begin
  inherited;
  registromarcodigo.AsInteger := 1;
  registrotrbcodigo.AsInteger := 1;
  registroicmcodigo.AsString := '00';
  registrotpocodigo.AsInteger := 1;
  registropronumserie.AsInteger := 0;
  registroprocomposto.AsInteger := 0;
  registroprobalanca.AsInteger := 0;
  registroproestoque.AsInteger := 1;
  registrosipcodigo.AsInteger := 1;
  registropropedecomple.AsInteger := 0;
  registropropededescrserv.AsInteger := 0;
  registropropedetecnicoserv.AsInteger := 0;
  registrodprcodigo.AsInteger := 1;
  registroprovalidade.asinteger:=0;


end;

end.
