unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls,system.Net.HttpClient,system.JSON;

type
  TForm1 = class(TForm)
    Memo1: TMemo;
    Button1: TButton;
    cboPagamento: TComboBox;
    edtValor: TEdit;
    Label1: TLabel;
    Label2: TLabel;
    procedure Button1Click(Sender: TObject);
  private
    function valor(pValor: string): string;

  public

  end;

var
  Form1: TForm1;

implementation

uses
  System.Net.URLClient;

{$R *.dfm}

function TForm1.valor(pValor: string): string;
begin
  pValor := StringReplace(pValor, ',', '.', [rfReplaceAll]);
  Result := StringReplace(pValor, '.', '' , [rfReplaceAll]);
end;
procedure TForm1.Button1Click(Sender: TObject);
var
httpClient    : THTTPClient;
requestStream : TStringStream;
Response      : IHTTPResponse;
Parcelas      : string;
ValorPagoStr  : string;
xValTransacao : integer;
obj,objR           : TJSONObject;
begin
         httpClient                    := THTTPClient.Create;
         HttpClient.ContentType        := 'application/json';
         HttpClient.Accept             := '/';
         HttpClient.SendTimeout        := 120000;
         HttpClient.FResponseTimeout   := 120000;
         HttpClient.FConnectionTimeout := 120000;
         requestStream                 := TStringStream.Create;

         if cboPagamento.ItemIndex = 1 then
          Parcelas := '2'
         else
          Parcelas := '1';


         Response                      := httpClient.post('http://192.168.1.47:9911/Pagamento',requestStream, nil,
                                           TNetHeaders.Create(
                                                            TNameValuePair.Create('tipopagamento'   ,cboPagamento.Text),
                                                            TNameValuePair.Create('valor' , valor(edtValor.Text) ),
                                                            TNameValuePair.Create('parcelas' , Parcelas) ,
                                                            TNameValuePair.Create('pedido' , '112233')
                                                            )
                                                            );

         obj := TJSONObject.ParseJSONValue(Response.ContentAsString) as TJSONObject;
        try
          Memo1.Lines.Add('status: ' + obj.GetValue('status').Value);

          try
            Memo1.Lines.Add('NSU: '            + obj.GetValue('NSU').Value);
            Memo1.Lines.Add('TipoTransacao: '  + obj.GetValue('TipoTransacao').Value);
            Memo1.Lines.Add('Bandeira: '       + obj.GetValue('Bandeira').Value);
            Memo1.Lines.Add('NomeAdquirente: ' + obj.GetValue('NomeAdquirente').Value);
            Memo1.Lines.Add('CnpjAdquirente: ' + obj.GetValue('CnpjAdquirente').Value);
          finally

          end;
        finally
          obj.Free;
        end;
         Memo1.Lines.Add(StringOfChar('=',50));

end;

end.
